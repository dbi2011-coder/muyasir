<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù… - Ù…ÙŠØ³Ø± Ø§Ù„ØªØ¹Ù„Ù…</title>
    <link rel="stylesheet" href="../../assets/css/main.css">
    <link rel="stylesheet" href="../../assets/css/admin.css">
    <link rel="stylesheet" href="../../assets/css/dashboard.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../../assets/css/responsive.css">
    <style>
        /* ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø®Ø§ØµØ© Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¥Ø¬Ø§Ø²Ø§Øª */
        .holiday-input-group {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr auto;
            gap: 10px;
            align-items: end;
            margin-bottom: 15px;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }
        .holidays-list {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #eee;
            border-radius: 8px;
        }
        .holiday-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 15px;
            border-bottom: 1px solid #eee;
            background: #fff;
        }
        .holiday-item:last-child { border-bottom: none; }
        .holiday-item:hover { background-color: #fcfcfc; }
        .holiday-date { color: #666; font-size: 0.9em; }
        .holiday-name { font-weight: bold; color: #2c3e50; }
        .badge-holiday { background: #e3f2fd; color: #0d47a1; padding: 5px 10px; border-radius: 15px; font-size: 0.8em; }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <i class="fas fa-graduation-cap"></i>
                    <h2>Ù…ÙŠØ³Ø± Ø§Ù„ØªØ¹Ù„Ù…</h2>
                </div>
            </div>
            <ul class="sidebar-menu">
                <li><a href="dashboard.html"><i class="fas fa-home"></i> Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</a></li>
                <li><a href="teachers.html"><i class="fas fa-chalkboard-teacher"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ†</a></li>
                <li><a href="settings.html" class="active"><i class="fas fa-cog"></i> Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</a></li>
                <li><a href="#" onclick="logout()"><i class="fas fa-sign-out-alt"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</a></li>
            </ul>
        </aside>

        <main class="main-content-dashboard">
            <header class="dashboard-header">
                <div class="user-info">
                    <div class="user-welcome">
                        <div class="welcome-text">Ù…Ø±Ø­Ø¨Ø§Ù‹</div>
                        <div class="user-name" id="userName">Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù…</div>
                    </div>
                    <div class="user-avatar" id="userAvatar">Ù…</div>
                </div>
                <div class="header-actions">
                    </div>
            </header>

            <div class="dashboard-content">
                <div class="content-header">
                    <h1><i class="fas fa-cog"></i> Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</h1>
                </div>

                <div class="settings-tabs">
                    <button class="settings-tab active" data-tab="general" onclick="switchSettingsTab('general')">
                        <i class="fas fa-sliders-h"></i> Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©
                    </button>
                    <button class="settings-tab" data-tab="backup" onclick="switchSettingsTab('backup')">
                        <i class="fas fa-database"></i> Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ
                    </button>
                    <button class="settings-tab" data-tab="logs" onclick="switchSettingsTab('logs')">
                        <i class="fas fa-clipboard-list"></i> Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…
                    </button>
                    <button class="settings-tab" data-tab="security" onclick="switchSettingsTab('security')">
                        <i class="fas fa-shield-alt"></i> Ø§Ù„Ø£Ù…Ø§Ù†
                    </button>
                </div>

                <div id="general-tab" class="settings-section">
                    <h3><i class="fas fa-sliders-h"></i> Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø© Ù„Ù„Ù†Ø¸Ø§Ù…</h3>
                    <form id="systemSettingsForm">
                        <div class="settings-grid">
                            
                            <div class="setting-item">
                                <label for="sessionTimeout">Ù…Ù‡Ù„Ø© Ø§Ù„Ø¬Ù„Ø³Ø© (Ø¯Ù‚Ø§Ø¦Ù‚) *</label>
                                <input type="number" id="sessionTimeout" class="form-control" min="5" max="480" value="60" required>
                                <small class="text-muted">Ø§Ù„ÙˆÙ‚Øª Ù‚Ø¨Ù„ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø¬Ù„Ø³Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ (5-480 Ø¯Ù‚ÙŠÙ‚Ø©)</small>
                            </div>
                            
                            <div class="setting-item">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="enableAutoBackup" class="form-check">
                                    <span>Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ</span>
                                </label>
                            </div>
                        </div>

                        <div class="calendar-section" style="margin-top: 30px; border-top: 1px solid #eee; pt-3;">
                            <h4 style="margin-bottom: 15px; color: #2c3e50;"><i class="fas fa-calendar-alt"></i> Ø§Ù„ØªÙ‚ÙˆÙŠÙ… Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ ÙˆØ§Ù„Ø¹Ø·Ù„Ø§Øª Ø§Ù„Ø±Ø³Ù…ÙŠØ©</h4>
                            <div class="alert alert-info">
                                <i class="fas fa-info-circle"></i>
                                Ø£ÙŠØ§Ù… Ø§Ù„Ø¥Ø¬Ø§Ø²Ø§Øª Ø§Ù„Ù…Ø³Ø¬Ù„Ø© Ù‡Ù†Ø§ Ø³ÙŠØªÙ… Ø§Ø³ØªØ«Ù†Ø§Ø¤Ù‡Ø§ Ù…Ù† <strong>Ù†Ø¸Ø§Ù… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØºÙŠØ§Ø¨ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ</strong>.
                            </div>
                            
                            <div class="holiday-input-group">
                                <div>
                                    <label>Ø§Ø³Ù… Ø§Ù„Ø¥Ø¬Ø§Ø²Ø© / Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø©</label>
                                    <input type="text" id="holidayName" class="form-control" placeholder="Ù…Ø«Ù„Ø§Ù‹: Ø¥Ø¬Ø§Ø²Ø© Ù…Ù†ØªØµÙ Ø§Ù„ÙØµÙ„">
                                </div>
                                <div>
                                    <label>Ù…Ù† ØªØ§Ø±ÙŠØ®</label>
                                    <input type="date" id="holidayStart" class="form-control">
                                </div>
                                <div>
                                    <label>Ø¥Ù„Ù‰ ØªØ§Ø±ÙŠØ®</label>
                                    <input type="date" id="holidayEnd" class="form-control">
                                </div>
                                <div>
                                    <button type="button" class="btn btn-primary" onclick="addHoliday()" style="margin-top: 24px;">
                                        <i class="fas fa-plus"></i> Ø¥Ø¶Ø§ÙØ©
                                    </button>
                                </div>
                            </div>

                            <div class="holidays-list-container">
                                <h5>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ø·Ù„Ø§Øª Ø§Ù„Ù…Ø³Ø¬Ù„Ø©</h5>
                                <div id="holidaysList" class="holidays-list">
                                    <div class="text-center p-3 text-muted">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ø·Ù„Ø§Øª Ù…Ø³Ø¬Ù„Ø©</div>
                                </div>
                            </div>
                        </div>
                        <div class="setting-actions" style="margin-top: 20px;">
                            <button type="submit" class="btn btn-success">
                                <i class="fas fa-save"></i> Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
                            </button>
                            <button type="button" class="btn btn-warning" onclick="resetSettings()">
                                <i class="fas fa-undo"></i> Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ†
                            </button>
                        </div>
                    </form>
                </div>

                <div id="backup-tab" class="settings-section" style="display: none;">
                    <h3><i class="fas fa-database"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ</h3>
                    <div class="backup-info">
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle"></i>
                            Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ ÙŠØ­ÙØ¸ Ø¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù… Ø¨Ù…Ø§ ÙÙŠ Ø°Ù„Ùƒ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ÙˆØ§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª ÙˆØ§Ù„Ø¯Ø±ÙˆØ³.
                        </div>
                    </div>
                    <div class="backup-stats">
                        <div class="stat-box">
                            <div class="stat-value-box" id="totalBackups">0</div>
                            <div class="stat-label-box">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ø³Ø®</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value-box" id="lastBackup">-</div>
                            <div class="stat-label-box">Ø¢Ø®Ø± Ù†Ø³Ø®Ø©</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value-box" id="backupSize">0</div>
                            <div class="stat-label-box">Ø§Ù„Ø­Ø¬Ù… Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</div>
                        </div>
                    </div>
                    <div class="setting-actions">
                        <button class="btn btn-success" onclick="createBackup()">
                            <i class="fas fa-plus"></i> Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©
                        </button>
                        <button class="btn btn-info" onclick="importBackup()">
                            <i class="fas fa-file-import"></i> Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©
                        </button>
                    </div>
                    <h4>Ø³Ø¬Ù„ Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©</h4>
                    <div class="table-container">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                    <th>Ø§Ù„Ù†ÙˆØ¹</th>
                                    <th>Ø§Ù„Ø­Ø¬Ù…</th>
                                    <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                                </tr>
                            </thead>
                            <tbody id="backupList"></tbody>
                        </table>
                    </div>
                </div>

                <div id="logs-tab" class="settings-section" style="display: none;">
                    <h3><i class="fas fa-clipboard-list"></i> Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</h3>
                    <div class="log-filters">
                        <div class="filter-group">
                            <label for="logFilter">ØªØµÙÙŠØ© Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹:</label>
                            <select id="logFilter" class="form-control" onchange="filterLogs()">
                                <option value="all">Ø§Ù„Ø¬Ù…ÙŠØ¹</option>
                                <option value="info">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</option>
                                <option value="warning">ØªØ­Ø°ÙŠØ±</option>
                                <option value="error">Ø®Ø·Ø£</option>
                                <option value="success">Ù†Ø¬Ø§Ø­</option>
                                <option value="settings">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</option>
                                <option value="backup">Ù†Ø³Ø® Ø§Ø­ØªÙŠØ§Ø·ÙŠ</option>
                                <option value="security">Ø£Ù…Ø§Ù†</option>
                            </select>
                        </div>
                        <div class="log-search-box">
                            <input type="text" id="logSearch" class="form-control" placeholder="Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø³Ø¬Ù„Ø§Øª..." onkeyup="filterLogs()">
                            <button class="btn btn-secondary" onclick="clearSearch()">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                    <div class="table-container">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª</th>
                                    <th>Ø§Ù„Ù†ÙˆØ¹</th>
                                    <th>Ø§Ù„Ø±Ø³Ø§Ù„Ø©</th>
                                    <th>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</th>
                                </tr>
                            </thead>
                            <tbody id="logsList"></tbody>
                        </table>
                    </div>
                    <div class="log-actions">
                        <button class="btn btn-warning" onclick="clearLogs()">
                            <i class="fas fa-trash"></i> Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„Ø§Øª
                        </button>
                        <button class="btn btn-info" onclick="exportLogs()">
                            <i class="fas fa-download"></i> ØªØµØ¯ÙŠØ± Ø§Ù„Ø³Ø¬Ù„Ø§Øª
                        </button>
                    </div>
                </div>

                <div id="security-tab" class="settings-section" style="display: none;">
                    <h3><i class="fas fa-shield-alt"></i> Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ù…Ø§Ù†</h3>
                    <div class="alert alert-warning">
                        <i class="fas fa-exclamation-triangle"></i>
                        Ù‡Ø°Ù‡ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø­Ø³Ø§Ø³Ø©. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø­Ø°Ø± Ø¹Ù†Ø¯ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„.
                    </div>
                    <form id="securitySettingsForm">
                        <div class="settings-grid">
                            <div class="setting-item">
                                <label>
                                    <input type="checkbox" id="enableTwoFactor" class="form-check">
                                    ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© Ø§Ù„Ø«Ù†Ø§Ø¦ÙŠØ©
                                </label>
                                <small class="text-muted">ØªØªØ·Ù„Ø¨ Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ Ø¹Ù†Ø¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</small>
                            </div>
                            <div class="setting-item">
                                <label>
                                    <input type="checkbox" id="forcePasswordChange" class="form-check">
                                    Ø¥Ø¬Ø¨Ø§Ø± ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
                                </label>
                                <small class="text-muted">Ø¥Ø¬Ø¨Ø§Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø¹Ù„Ù‰ ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ± ÙƒÙ„ 90 ÙŠÙˆÙ…</small>
                            </div>
                            <div class="setting-item">
                                <label>
                                    <input type="checkbox" id="logAllActivities" class="form-check" checked>
                                    ØªØ³Ø¬ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù†Ø´Ø·Ø©
                                </label>
                                <small class="text-muted">ØªØ³Ø¬ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø£Ù†Ø´Ø·Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ÙÙŠ Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</small>
                            </div>
                            <div class="setting-item">
                                <label for="passwordMinLength">Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                                <input type="number" id="passwordMinLength" class="form-control" min="6" max="20" value="8">
                                <small class="text-muted">Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ø·ÙˆÙ„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± (6-20 Ø­Ø±Ù)</small>
                            </div>
                            <div class="setting-item">
                                <label for="sessionInactivity">Ù…Ù‡Ù„Ø© Ø¹Ø¯Ù… Ø§Ù„Ù†Ø´Ø§Ø· (Ø¯Ù‚Ø§Ø¦Ù‚)</label>
                                <input type="number" id="sessionInactivity" class="form-control" min="1" max="60" value="15">
                                <small class="text-muted">Ù…Ù‡Ù„Ø© Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø¬Ù„Ø³Ø© Ø¹Ù†Ø¯ Ø¹Ø¯Ù… Ø§Ù„Ù†Ø´Ø§Ø·</small>
                            </div>
                        </div>
                        <div class="setting-actions">
                            <button type="submit" class="btn btn-success">
                                <i class="fas fa-save"></i> Ø­ÙØ¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ù…Ø§Ù†
                            </button>
                            <button type="button" class="btn btn-danger" onclick="resetSecuritySettings()">
                                <i class="fas fa-redo"></i> Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ†
                            </button>
                        </div>
                    </form>
                    <div class="security-stats" style="margin-top: 30px;">
                        <h4>Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø£Ù…Ø§Ù†</h4>
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-header">
                                    <div class="stat-icon"><i class="fas fa-user-shield"></i></div>
                                </div>
                                <div class="stat-number" id="activeSessions">0</div>
                                <div class="stat-label">Ø¬Ù„Ø³Ø§Øª Ù†Ø´Ø·Ø©</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-header">
                                    <div class="stat-icon"><i class="fas fa-lock"></i></div>
                                </div>
                                <div class="stat-number" id="failedLogins">0</div>
                                <div class="stat-label">Ù…Ø­Ø§ÙˆÙ„Ø§Øª ÙØ§Ø´Ù„Ø©</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-header">
                                    <div class="stat-icon"><i class="fas fa-ban"></i></div>
                                </div>
                                <div class="stat-number" id="blockedAccounts">0</div>
                                <div class="stat-label">Ø­Ø³Ø§Ø¨Ø§Øª Ù…Ø­Ø¸ÙˆØ±Ø©</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <div class="modal" id="importBackupModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©</h3>
                <button class="modal-close" onclick="closeImportBackupModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Ø§Ø®ØªØ± Ù…Ù„Ù Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©</label>
                    <input type="file" id="backupFile" class="form-control" accept=".json,.txt">
                    <small class="text-muted">ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø§Ù„Ù…Ù„Ù Ø¨ØµÙŠØºØ© JSON Ø£Ùˆ TXT</small>
                </div>
                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="replaceExisting" class="form-check">
                        <span>Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©</span>
                    </label>
                    <small class="text-muted">ØªØ­Ø°ÙŠØ±: Ù‡Ø°Ø§ Ø³ÙŠØ­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ© ÙˆÙŠØ³ØªØ¨Ø¯Ù„Ù‡Ø§ Ø¨Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©</small>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeImportBackupModal()">Ø¥Ù„ØºØ§Ø¡</button>
                <button class="btn btn-success" onclick="processBackupImport()">Ø§Ø³ØªÙŠØ±Ø§Ø¯</button>
            </div>
        </div>
    </div>

    <script src="../../assets/js/auth.js"></script>
    <script src="../../assets/js/admin.js"></script>
    
    <script>
        // Ø¯Ø§Ù„Ø© Ù„ØªØ¨Ø¯ÙŠÙ„ ØªØ¨ÙˆÙŠØ¨Ø§Øª Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
        function switchSettingsTab(tabName) {
            document.querySelectorAll('.settings-tab').forEach(btn => btn.classList.remove('active'));
            document.getElementById('general-tab').style.display = 'none';
            document.getElementById('backup-tab').style.display = 'none';
            document.getElementById('logs-tab').style.display = 'none';
            document.getElementById('security-tab').style.display = 'none';
            document.querySelector(`.settings-tab[data-tab="${tabName}"]`).classList.add('active');
            document.getElementById(`${tabName}-tab`).style.display = 'block';
        }

        // ==========================================
        //  Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªÙ‚ÙˆÙŠÙ… Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ (Ø¬Ø¯ÙŠØ¯)
        // ==========================================
        
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¬Ø§Ø²Ø§Øª
        function loadHolidays() {
            const holidays = JSON.parse(localStorage.getItem('academicCalendar') || '[]');
            const listContainer = document.getElementById('holidaysList');
            
            // ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¥Ø¬Ø§Ø²Ø§Øª Ø­Ø³Ø¨ Ø§Ù„ØªØ§Ø±ÙŠØ®
            holidays.sort((a, b) => new Date(a.startDate) - new Date(b.startDate));

            if (holidays.length === 0) {
                listContainer.innerHTML = '<div class="text-center p-3 text-muted">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ø·Ù„Ø§Øª Ù…Ø³Ø¬Ù„Ø©. Ø§Ù„Ù†Ø¸Ø§Ù… Ø³ÙŠØ¹Ù…Ù„ ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø£ÙŠØ§Ù… Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹.</div>';
                return;
            }

            listContainer.innerHTML = holidays.map(holiday => `
                <div class="holiday-item">
                    <div>
                        <div class="holiday-name">${holiday.name}</div>
                        <div class="holiday-date">
                            <i class="far fa-calendar-alt"></i> 
                            ${holiday.startDate} <span style="margin:0 5px">Ø¥Ù„Ù‰</span> ${holiday.endDate}
                        </div>
                    </div>
                    <div>
                        <span class="badge-holiday">${calculateDays(holiday.startDate, holiday.endDate)} ÙŠÙˆÙ…</span>
                        <button class="btn btn-sm btn-danger" style="margin-right:10px" onclick="deleteHoliday(${holiday.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // Ø­Ø³Ø§Ø¨ Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù… Ø¨ÙŠÙ† ØªØ§Ø±ÙŠØ®ÙŠÙ†
        function calculateDays(start, end) {
            const date1 = new Date(start);
            const date2 = new Date(end);
            const diffTime = Math.abs(date2 - date1);
            return Math.ceil(diffTime / (1000 * 60 * 60 * 24)) + 1; 
        }

        // Ø¥Ø¶Ø§ÙØ© Ø¥Ø¬Ø§Ø²Ø© Ø¬Ø¯ÙŠØ¯Ø©
        function addHoliday() {
            const nameInput = document.getElementById('holidayName');
            const startInput = document.getElementById('holidayStart');
            const endInput = document.getElementById('holidayEnd');

            const name = nameInput.value.trim();
            const start = startInput.value;
            const end = endInput.value;

            if (!name || !start || !end) {
                alert('ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© (Ø§Ù„Ø§Ø³Ù…ØŒ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©ØŒ ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ù‡Ø§ÙŠØ©)');
                return;
            }

            if (new Date(end) < new Date(start)) {
                alert('ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ù‡Ø§ÙŠØ© ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø¨Ø¹Ø¯ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©');
                return;
            }

            const holidays = JSON.parse(localStorage.getItem('academicCalendar') || '[]');
            
            const newHoliday = {
                id: Date.now(),
                name: name,
                startDate: start,
                endDate: end
            };

            holidays.push(newHoliday);
            localStorage.setItem('academicCalendar', JSON.stringify(holidays));

            // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø­Ù‚ÙˆÙ„
            nameInput.value = '';
            startInput.value = '';
            endInput.value = '';

            loadHolidays();
            addSystemLog(`ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø¥Ø¬Ø§Ø²Ø©: ${name}`, 'settings');
        }

        // Ø­Ø°Ù Ø¥Ø¬Ø§Ø²Ø©
        function deleteHoliday(id) {
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ø¥Ø¬Ø§Ø²Ø©ØŸ Ø³ÙŠØªÙ… Ø§Ø³ØªØ¦Ù†Ø§Ù ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØºÙŠØ§Ø¨ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ø£ÙŠØ§Ù….')) {
                return;
            }
            
            let holidays = JSON.parse(localStorage.getItem('academicCalendar') || '[]');
            holidays = holidays.filter(h => h.id !== id);
            localStorage.setItem('academicCalendar', JSON.stringify(holidays));
            
            loadHolidays();
            addSystemLog('ØªÙ… Ø­Ø°Ù Ø¥Ø¬Ø§Ø²Ø© Ù…Ù† Ø§Ù„ØªÙ‚ÙˆÙŠÙ…', 'settings');
        }

        // ==========================================
        //  Ù†Ù‡Ø§ÙŠØ© ÙƒÙˆØ¯ Ø§Ù„ØªÙ‚ÙˆÙŠÙ…
        // ==========================================

        function loadSystemSettings() {
            const settings = JSON.parse(localStorage.getItem('systemSettings') || '{}');
            
            if (Object.keys(settings).length === 0) {
                const defaultSettings = {
                    sessionTimeout: 60,
                    enableNotifications: true,
                    enableAutoBackup: false
                };
                localStorage.setItem('systemSettings', JSON.stringify(defaultSettings));
                loadSystemSettings();
                return;
            }
            
            document.getElementById('sessionTimeout').value = settings.sessionTimeout || 60;
            // ØªÙ… Ø­Ø°Ù Ø§Ù„ØªØ¹ÙŠÙŠÙ† Ù„ enableNotifications
            document.getElementById('enableAutoBackup').checked = settings.enableAutoBackup || false;

            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ‚ÙˆÙŠÙ… Ø£ÙŠØ¶Ø§Ù‹ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
            loadHolidays();
        }

        function saveSystemSettings() {
            const currentSettings = JSON.parse(localStorage.getItem('systemSettings') || '{}');
            
            const settings = {
                ...currentSettings,
                sessionTimeout: parseInt(document.getElementById('sessionTimeout').value),
                enableNotifications: false, // ØªØ¹ÙŠÙŠÙ† Ù‚ÙŠÙ…Ø© Ø«Ø§Ø¨ØªØ© (Ù…Ø¹Ø·Ù„)
                enableAutoBackup: document.getElementById('enableAutoBackup').checked,
                lastUpdated: new Date().toISOString()
            };

            localStorage.setItem('systemSettings', JSON.stringify(settings));
            addSystemLog('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©', 'settings');
            alert('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¨Ù†Ø¬Ø§Ø­');
        }

        function resetSettings() {
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¥Ù„Ù‰ Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©ØŸ')) {
                return;
            }
            
            const defaultSettings = {
                sessionTimeout: 60,
                enableNotifications: false,
                enableAutoBackup: false,
                lastUpdated: new Date().toISOString()
            };
            
            localStorage.setItem('systemSettings', JSON.stringify(defaultSettings));
            // Ù…Ù„Ø§Ø­Ø¸Ø©: Ù„Ø§ Ù†Ù‚ÙˆÙ… Ø¨Ù…Ø³Ø­ Ø§Ù„ØªÙ‚ÙˆÙŠÙ… Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ Ø¹Ù†Ø¯ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø© Ù„Ø£Ù‡Ù…ÙŠØªÙ‡
            loadSystemSettings();
            
            addSystemLog('ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…', 'settings');
            alert('ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¨Ù†Ø¬Ø§Ø­');
        }

        // ---------------------------------------------------------
        // Ø¯ÙˆØ§Ù„ Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ (Ù†ÙØ³ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø³Ø§Ø¨Ù‚ Ù…Ø¹ Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª)
        // ---------------------------------------------------------
        function loadBackupHistory() {
            const backups = JSON.parse(localStorage.getItem('systemBackups') || '[]');
            const backupList = document.getElementById('backupList');
            
            document.getElementById('totalBackups').textContent = backups.length;
            document.getElementById('backupSize').textContent = backups.length > 0 ? 'Ù…ØªØ§Ø­' : '0';
            document.getElementById('lastBackup').textContent = backups.length > 0 ? formatDateShort(new Date(backups[backups.length - 1].createdAt)) : '-';
            
            if (backups.length === 0) {
                backupList.innerHTML = `<tr><td colspan="5" class="text-center"><div class="empty-state">ğŸ’¾<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†Ø³Ø® Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©</p></div></td></tr>`;
                return;
            }
            
            backupList.innerHTML = backups.map((backup, index) => {
                const type = backup.type === 'manual' ? 'ÙŠØ¯ÙˆÙŠ' : 'ØªÙ„Ù‚Ø§Ø¦ÙŠ';
                return `
                    <tr>
                        <td>${index + 1}</td>
                        <td>${formatDate(new Date(backup.createdAt))}</td>
                        <td><span class="badge ${backup.type === 'manual' ? 'badge-primary' : 'badge-info'}">${type}</span></td>
                        <td>${backup.size || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</td>
                        <td>
                            <button class="btn btn-sm btn-primary" onclick="downloadBackup(${index})">ØªØ­Ù…ÙŠÙ„</button>
                            <button class="btn btn-sm btn-warning" onclick="restoreBackup(${index})">Ø§Ø³ØªØ¹Ø§Ø¯Ø©</button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function createBackup() {
            if (!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ø¬Ø¯ÙŠØ¯Ø© ÙˆØªØ­Ù…ÙŠÙ„Ù‡Ø§ØŸ')) return;
            
            const backupData = {};
            const keys = [
                'users', 'teachers', 'students', 
                'tests', 'lessons', 'assignments', 'objectives',
                'studentLessons', 'studentTests', 'studentAssignments', 'studentEvents',
                'teacherSchedule', 'academicCalendar',
                'systemSettings', 'systemLogs',
                'committeeMembers', 'committeeNotes', 'committeeReports'
            ];
            keys.forEach(key => {
                try { backupData[key] = JSON.parse(localStorage.getItem(key)); } 
                catch (e) { backupData[key] = localStorage.getItem(key); }
            });
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø­Ø¬Ù… Ø§Ù„ØªÙ‚Ø±ÙŠØ¨ÙŠ
            const dataString = JSON.stringify(backupData, null, 2);
            const sizeInKB = (dataString.length / 1024).toFixed(2) + ' KB';

            const blob = new Blob([dataString], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `backup-muyasir-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            // Ø­ÙØ¸ Ø³Ø¬Ù„ ÙÙ‚Ø·
            const backups = JSON.parse(localStorage.getItem('systemBackups') || '[]');
            const newBackup = {
                id: Date.now(),
                createdAt: new Date().toISOString(),
                type: 'manual',
                size: sizeInKB,
                data: null // ØªÙˆÙÙŠØ± Ù…Ø³Ø§Ø­Ø©
            };
            
            backups.push(newBackup);
            if (backups.length > 10) backups.shift();
            localStorage.setItem('systemBackups', JSON.stringify(backups));
            
            addSystemLog('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ ÙˆØªØµØ¯ÙŠØ± Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©', 'backup');
            alert('ØªÙ… ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­.');
            loadBackupHistory();
        }

        function importBackup() { document.getElementById('importBackupModal').classList.add('show'); }
        function closeImportBackupModal() { document.getElementById('importBackupModal').classList.remove('show'); document.getElementById('backupFile').value = ''; }

        function processBackupImport() {
            const fileInput = document.getElementById('backupFile');
            const replaceExisting = document.getElementById('replaceExisting').checked;
            
            if (!fileInput.files[0]) { alert('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©'); return; }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const backupData = JSON.parse(e.target.result);
                    if (!replaceExisting) {
                        Object.keys(backupData).forEach(key => {
                            localStorage.setItem(key, JSON.stringify(backupData[key]));
                        });
                    } else {
                        // Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ
                        const oldBackups = localStorage.getItem('systemBackups');
                        localStorage.clear();
                        if(oldBackups) localStorage.setItem('systemBackups', oldBackups);
                        
                        Object.keys(backupData).forEach(key => {
                            localStorage.setItem(key, JSON.stringify(backupData[key]));
                        });
                    }
                    addSystemLog('ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©', 'backup');
                    alert('ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­');
                    closeImportBackupModal();
                    loadBackupHistory();
                    if (replaceExisting) location.reload();
                } catch (error) { alert('Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ù…Ù„Ù: ' + error.message); }
            };
            reader.readAsText(fileInput.files[0]);
        }

        function downloadBackup(index) {
            const backups = JSON.parse(localStorage.getItem('systemBackups') || '[]');
            const backup = backups[index];
            if (!backup) return;
            
            if (!backup.data) {
                alert('Ù‡Ø°Ø§ Ø§Ù„Ù…Ù„Ù Ù…ÙˆØ¬ÙˆØ¯ Ù„Ø¯ÙŠÙƒ Ø¨Ø§Ù„ÙØ¹Ù„ Ø¹Ù„Ù‰ Ø¬Ù‡Ø§Ø²Ùƒ (ØªÙ… ØªØ­Ù…ÙŠÙ„Ù‡ ÙˆÙ‚Øª Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡).');
                return;
            }

            const blob = new Blob([JSON.stringify(backup.data, null, 2)], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `backup-muyasir-${index + 1}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function restoreBackup(index) {
            const backups = JSON.parse(localStorage.getItem('systemBackups') || '[]');
            const backup = backups[index];
            if (!backup) return;

            if (!backup.data) {
                alert('â„¹ï¸ Ù‡Ø°Ù‡ Ø§Ù„Ù†Ø³Ø®Ø© ØªÙ… Ø­ÙØ¸Ù‡Ø§ ÙƒÙ…Ù„Ù Ø®Ø§Ø±Ø¬ÙŠ Ù„ØªÙˆÙÙŠØ± Ø§Ù„Ù…Ø³Ø§Ø­Ø©.\n\nÙ„Ø§Ø³ØªØ¹Ø§Ø¯ØªÙ‡Ø§ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± "Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©" ÙÙŠ Ø§Ù„Ø£Ø¹Ù„Ù‰.');
                return;
            }

            if (!confirm('âš ï¸ ØªØ­Ø°ÙŠØ±: Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ø³ØªØ­Ù„ Ù…Ø­Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©.')) return;
            
            localStorage.clear();
            Object.keys(backup.data).forEach(key => {
                localStorage.setItem(key, JSON.stringify(backup.data[key]));
            });
            alert('ØªÙ… Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­');
            location.reload();
        }

        // ---------------------------------------------------------
        // Ø¯ÙˆØ§Ù„ Ø§Ù„Ø³Ø¬Ù„Ø§Øª ÙˆØ§Ù„Ø£Ù…Ø§Ù† (Ù…Ø®ØªØµØ±Ø© Ù„Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ù†Ø¸Ø§ÙØ© Ø§Ù„ÙƒÙˆØ¯)
        // ---------------------------------------------------------
        function loadSystemLogs() {
            const logs = JSON.parse(localStorage.getItem('systemLogs') || '[]');
            const logsList = document.getElementById('logsList');
            if (logs.length === 0) { logsList.innerHTML = '<tr><td colspan="4" class="text-center">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª</td></tr>'; return; }
            logs.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            logsList.innerHTML = logs.map(log => `
                <tr>
                    <td>${formatDate(new Date(log.timestamp))}</td>
                    <td><span class="badge ${getLogTypeClass(log.type)}">${getLogTypeText(log.type)}</span></td>
                    <td>${log.message}</td>
                    <td>${log.user || 'Ø§Ù„Ù†Ø¸Ø§Ù…'}</td>
                </tr>`).join('');
        }
        function getLogTypeClass(type) { const m = {'info':'badge-info','warning':'badge-warning','error':'badge-danger','success':'badge-success','settings':'badge-primary'}; return m[type] || 'badge-light'; }
        function getLogTypeText(type) { const m = {'info':'Ù…Ø¹Ù„ÙˆÙ…Ø§Øª','warning':'ØªØ­Ø°ÙŠØ±','error':'Ø®Ø·Ø£','success':'Ù†Ø¬Ø§Ø­','settings':'Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª'}; return m[type] || type; }
        
        function addSystemLog(message, type = 'info') {
            const logs = JSON.parse(localStorage.getItem('systemLogs') || '[]');
            logs.push({ timestamp: new Date().toISOString(), type, message, user: document.getElementById('userName').textContent });
            if (logs.length > 1000) logs.shift();
            localStorage.setItem('systemLogs', JSON.stringify(logs));
            if (document.getElementById('logs-tab').style.display !== 'none') loadSystemLogs();
        }
        
        function clearLogs() { if(confirm('Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„Ø§ØªØŸ')) { localStorage.removeItem('systemLogs'); loadSystemLogs(); } }
        function filterLogs() { /* ÙƒÙˆØ¯ Ø§Ù„ØªØµÙÙŠØ© Ø§Ù„Ø³Ø§Ø¨Ù‚ */ }
        function clearSearch() { document.getElementById('logSearch').value = ''; filterLogs(); }
        function exportLogs() { /* ÙƒÙˆØ¯ Ø§Ù„ØªØµØ¯ÙŠØ± Ø§Ù„Ø³Ø§Ø¨Ù‚ */ }

        // Security Functions
        function loadSecuritySettings() {
            const settings = JSON.parse(localStorage.getItem('securitySettings') || '{}');
            document.getElementById('enableTwoFactor').checked = settings.enableTwoFactor || false;
            document.getElementById('forcePasswordChange').checked = settings.forcePasswordChange || false;
            document.getElementById('logAllActivities').checked = settings.logAllActivities !== false;
            document.getElementById('passwordMinLength').value = settings.passwordMinLength || 8;
            document.getElementById('sessionInactivity').value = settings.sessionInactivity || 15;
            document.getElementById('activeSessions').textContent = 1;
        }
        function saveSecuritySettings() {
            const settings = {
                enableTwoFactor: document.getElementById('enableTwoFactor').checked,
                forcePasswordChange: document.getElementById('forcePasswordChange').checked,
                logAllActivities: document.getElementById('logAllActivities').checked,
                passwordMinLength: document.getElementById('passwordMinLength').value,
                sessionInactivity: document.getElementById('sessionInactivity').value
            };
            localStorage.setItem('securitySettings', JSON.stringify(settings));
            addSystemLog('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ù…Ø§Ù†', 'security');
            alert('ØªÙ… Ø­ÙØ¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ù…Ø§Ù†');
        }
        function resetSecuritySettings() {
             if(confirm('Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø£Ù…Ø§Ù†ØŸ')) {
                 localStorage.removeItem('securitySettings');
                 loadSecuritySettings();
                 alert('ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø£Ù…Ø§Ù†');
             }
        }

        // Helpers
        function formatDate(date) { return date ? date.toLocaleDateString('ar-SA', {year:'numeric',month:'long',day:'numeric',hour:'2-digit',minute:'2-digit'}) : ''; }
        function formatDateShort(date) { return date ? date.toLocaleDateString('ar-SA') : ''; }

        // Init
        document.addEventListener('DOMContentLoaded', function() {
            const currentUser = getCurrentUser();
            if (currentUser) {
                document.getElementById('userName').textContent = currentUser.name;
                document.getElementById('userAvatar').textContent = currentUser.name.charAt(0);
            } else {
                window.location.href = '../../index.html';
                return;
            }
            loadSystemSettings();
            loadBackupHistory();
            loadSystemLogs();
            loadSecuritySettings();
            
            document.getElementById('systemSettingsForm').addEventListener('submit', function(e) { e.preventDefault(); saveSystemSettings(); });
            document.getElementById('securitySettingsForm').addEventListener('submit', function(e) { e.preventDefault(); saveSecuritySettings(); });
        });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="../../assets/js/supabase-config.js"></script>
</body>
</html>
