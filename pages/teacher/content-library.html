<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>مكتبة المحتوى التعليمي - ميسر التعلم</title>
    <!-- الخطوط -->
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700&display=swap" rel="stylesheet">
    <!-- الأيقونات -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- الأنماط -->
    <link rel="stylesheet" href="../../assets/css/main.css">
    <link rel="stylesheet" href="../../assets/css/dashboard.css">
    <link rel="stylesheet" href="../../assets/css/teacher.css">
    <link rel="stylesheet" href="../../assets/css/committee.css">
    <style>
        /* أنماط إضافية خاصة بمكتبة المحتوى */
        .content-toolbar {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .search-box {
            flex: 1;
            min-width: 300px;
            position: relative;
        }
        
        .search-box input {
            width: 100%;
            padding: 10px 40px 10px 15px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            font-family: 'Tajawal', sans-serif;
        }
        
        .search-box i {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-color);
        }
        
        .filter-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .content-type-filter {
            display: flex;
            gap: 5px;
            background: var(--light-color);
            padding: 5px;
            border-radius: 8px;
        }
        
        .type-btn {
            padding: 8px 15px;
            border: none;
            background: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .type-btn.active {
            background: white;
            color: var(--primary-color);
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .content-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .stats-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: var(--shadow);
            border-top: 4px solid var(--primary-color);
        }
        
        .stats-card.success {
            border-color: var(--success-color);
        }
        
        .stats-card.warning {
            border-color: var(--warning-color);
        }
        
        .stats-card.info {
            border-color: var(--primary-color);
        }
        
        .stats-value {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .stats-label {
            color: #666;
            font-size: 0.9rem;
        }
        
        /* تحسينات للهواتف */
        @media (max-width: 768px) {
            .content-toolbar {
                flex-direction: column;
                align-items: stretch;
            }
            
            .search-box {
                min-width: 100%;
            }
            
            .filter-buttons {
                justify-content: center;
            }
            
            .content-type-filter {
                flex-wrap: wrap;
            }
        }
    </style>
</head>
<body>
    <!-- الشريط الجانبي -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <div class="logo">
                <img src="../../assets/images/logo.png" alt="شعار ميسر التعلم">
                <h2>ميسر التعلم</h2>
            </div>
        </div>
        <ul class="sidebar-menu">
            <li><a href="dashboard.html"><i class="fas fa-home menu-icon"></i>الرئيسية</a></li>
            <li><a href="students.html"><i class="fas fa-users menu-icon"></i>الطلاب</a></li>
            <li><a href="content-library.html" class="active"><i class="fas fa-book-open menu-icon"></i>مكتبة المحتوى</a></li>
            <li><a href="tests.html"><i class="fas fa-clipboard-check menu-icon"></i>الاختبارات</a></li>
            <li><a href="assignments.html"><i class="fas fa-tasks menu-icon"></i>الواجبات</a></li>
            <li><a href="reports.html"><i class="fas fa-chart-bar menu-icon"></i>التقارير</a></li>
            <li><a href="committee.html"><i class="fas fa-user-friends menu-icon"></i>لجنة الصعوبات</a></li>
            <li><a href="#" onclick="logout()"><i class="fas fa-sign-out-alt menu-icon"></i>تسجيل الخروج</a></li>
        </ul>
    </aside>

    <!-- زر القائمة للموبايل -->
    <button class="mobile-menu-btn" onclick="toggleSidebar()">
        <i class="fas fa-bars"></i>
    </button>

    <!-- المحتوى الرئيسي -->
    <main class="main-content-dashboard">
        <!-- رأس الصفحة -->
        <header class="dashboard-header">
            <div class="user-info">
                <div class="user-avatar" id="userAvatar">م</div>
                <div class="user-welcome">
                    <div class="welcome-text">مرحباً</div>
                    <div class="user-name" id="userName">المعلم</div>
                </div>
            </div>
            <div class="header-actions">
                <button class="btn btn-primary" onclick="window.location.href='create-content.html'">
                    <i class="fas fa-plus"></i> محتوى جديد
                </button>
                <div class="notification-icon" onclick="showNotifications()">
                    <i class="fas fa-bell"></i>
                    <span class="notification-badge" id="notificationCount">2</span>
                </div>
            </div>
        </header>

        <!-- محتوى الصفحة -->
        <div class="dashboard-content">
            <div class="content-header">
                <h1><i class="fas fa-book-open"></i> مكتبة المحتوى التعليمي</h1>
                <button class="btn btn-success" onclick="showContentCreationModal()">
                    <i class="fas fa-plus"></i> إضافة محتوى جديد
                </button>
            </div>

            <!-- شريط البحث والتصفية -->
            <div class="content-toolbar">
                <div class="search-box">
                    <input type="text" id="contentSearch" placeholder="ابحث في المحتوى التعليمي..." onkeyup="searchContent()">
                    <i class="fas fa-search"></i>
                </div>
                <div class="filter-buttons">
                    <div class="content-type-filter">
                        <button class="type-btn active" onclick="filterContentByType('all')">الكل</button>
                        <button class="type-btn" onclick="filterContentByType('test')">اختبارات</button>
                        <button class="type-btn" onclick="filterContentByType('lesson')">دروس</button>
                        <button class="type-btn" onclick="filterContentByType('exercise')">تمارين</button>
                    </div>
                    <select class="form-control" id="subjectFilter" onchange="filterContent()" style="width: 150px;">
                        <option value="all">جميع المواد</option>
                        <option value="لغتي">لغتي</option>
                        <option value="رياضيات">رياضيات</option>
                        <option value="علوم">علوم</option>
                    </select>
                    <select class="form-control" id="gradeFilter" onchange="filterContent()" style="width: 150px;">
                        <option value="all">جميع الصفوف</option>
                        <option value="الصف الأول">الصف الأول</option>
                        <option value="الصف الثاني">الصف الثاني</option>
                        <option value="الصف الثالث">الصف الثالث</option>
                        <option value="الصف الرابع">الصف الرابع</option>
                        <option value="الصف الخامس">الصف الخامس</option>
                        <option value="الصف السادس">الصف السادس</option>
                    </select>
                </div>
            </div>

            <!-- إحصائيات سريعة -->
            <div class="content-stats">
                <div class="stats-card success">
                    <div class="stats-value" id="totalTests">0</div>
                    <div class="stats-label">اختبارات</div>
                </div>
                <div class="stats-card info">
                    <div class="stats-value" id="totalLessons">0</div>
                    <div class="stats-label">دروس</div>
                </div>
                <div class="stats-card warning">
                    <div class="stats-value" id="totalExercises">0</div>
                    <div class="stats-label">تمارين</div>
                </div>
                <div class="stats-card">
                    <div class="stats-value" id="totalUsage">0</div>
                    <div class="stats-label">مرات الاستخدام</div>
                </div>
            </div>

            <!-- مكتبة المحتوى -->
            <div class="library-sections">
                <!-- قسم الاختبارات -->
                <section class="library-section">
                    <div class="section-header">
                        <h2><i class="fas fa-clipboard-check"></i> الاختبارات التشخيصية</h2>
                        <button class="btn btn-primary" onclick="showCreateTestModal()">
                            <i class="fas fa-plus"></i> اختبار جديد
                        </button>
                    </div>
                    <div class="content-grid" id="testsGrid">
                        <!-- سيتم تعبئتها بواسطة JavaScript -->
                    </div>
                </section>

                <!-- قسم الدروس -->
                <section class="library-section">
                    <div class="section-header">
                        <h2><i class="fas fa-chalkboard-teacher"></i> الدروس التعليمية</h2>
                        <button class="btn btn-primary" onclick="showCreateLessonModal()">
                            <i class="fas fa-plus"></i> درس جديد
                        </button>
                    </div>
                    <div class="content-grid" id="lessonsGrid">
                        <!-- سيتم تعبئتها بواسطة JavaScript -->
                    </div>
                </section>

                <!-- قسم التمارين -->
                <section class="library-section">
                    <div class="section-header">
                        <h2><i class="fas fa-dumbbell"></i> التمارين والأنشطة</h2>
                        <button class="btn btn-primary" onclick="showCreateExerciseModal()">
                            <i class="fas fa-plus"></i> تمرين جديد
                        </button>
                    </div>
                    <div class="content-grid" id="exercisesGrid">
                        <!-- سيتم تعبئتها بواسطة JavaScript -->
                    </div>
                </section>
            </div>
        </div>
    </main>

    <!-- نماذج إنشاء المحتوى -->
    <!-- نموذج إنشاء اختبار -->
    <div class="modal" id="createTestModal">
        <div class="modal-content large">
            <div class="modal-header">
                <h3><i class="fas fa-clipboard-check"></i> إنشاء اختبار جديد</h3>
                <button class="modal-close" onclick="closeCreateTestModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="testForm">
                    <div class="form-group">
                        <label for="testTitle">عنوان الاختبار *</label>
                        <input type="text" id="testTitle" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="testSubject">المادة *</label>
                        <select id="testSubject" class="form-control" required>
                            <option value="">اختر المادة</option>
                            <option value="لغتي">لغتي</option>
                            <option value="رياضيات">رياضيات</option>
                            <option value="علوم">علوم</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="testGrade">الصف *</label>
                        <select id="testGrade" class="form-control" required>
                            <option value="">اختر الصف</option>
                            <option value="الصف الأول">الصف الأول</option>
                            <option value="الصف الثاني">الصف الثاني</option>
                            <option value="الصف الثالث">الصف الثالث</option>
                            <option value="الصف الرابع">الصف الرابع</option>
                            <option value="الصف الخامس">الصف الخامس</option>
                            <option value="الصف السادس">الصف السادس</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="testDescription">وصف الاختبار (اختياري)</label>
                        <textarea id="testDescription" class="form-control" rows="3"></textarea>
                    </div>
                    
                    <div class="questions-section">
                        <h4><i class="fas fa-question-circle"></i> أسئلة الاختبار</h4>
                        <div id="questionsContainer">
                            <!-- سيتم إضافة الأسئلة هنا -->
                        </div>
                        <button type="button" class="btn btn-secondary" onclick="addQuestion()">
                            <i class="fas fa-plus"></i> إضافة سؤال
                        </button>
                    </div>
                    
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" onclick="closeCreateTestModal()">إلغاء</button>
                        <button type="submit" class="btn btn-success">حفظ الاختبار</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- نموذج إنشاء درس -->
    <div class="modal" id="createLessonModal">
        <div class="modal-content large">
            <div class="modal-header">
                <h3><i class="fas fa-chalkboard-teacher"></i> إنشاء درس جديد</h3>
                <button class="modal-close" onclick="closeCreateLessonModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="lessonForm">
                    <div class="form-group">
                        <label for="lessonTitle">عنوان الدرس *</label>
                        <input type="text" id="lessonTitle" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="lessonStrategy">الاستراتيجية *</label>
                        <select id="lessonStrategy" class="form-control" required>
                            <option value="">اختر الاستراتيجية</option>
                            <option value="التعلم التعاوني">التعلم التعاوني</option>
                            <option value="التعلم القائم على المشكلات">التعلم القائم على المشكلات</option>
                            <option value="التعلم النشط">التعلم النشط</option>
                            <option value="التفكير الناقد">التفكير الناقد</option>
                            <option value="التعلم الذاتي">التعلم الذاتي</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="lessonSubject">المادة *</label>
                        <select id="lessonSubject" class="form-control" required>
                            <option value="">اختر المادة</option>
                            <option value="لغتي">لغتي</option>
                            <option value="رياضيات">رياضيات</option>
                            <option value="علوم">علوم</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="lessonGrade">الصف *</label>
                        <select id="lessonGrade" class="form-control" required>
                            <option value="">اختر الصف</option>
                            <option value="الصف الأول">الصف الأول</option>
                            <option value="الصف الثاني">الصف الثاني</option>
                            <option value="الصف الثالث">الصف الثالث</option>
                            <option value="الصف الرابع">الصف الرابع</option>
                            <option value="الصف الخامس">الصف الخامس</option>
                            <option value="الصف السادس">الصف السادس</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="lessonDescription">وصف الدرس (اختياري)</label>
                        <textarea id="lessonDescription" class="form-control" rows="3"></textarea>
                    </div>
                    
                    <div class="lesson-sections">
                        <h4><i class="fas fa-list"></i> أقسام الدرس</h4>
                        <div class="lesson-section">
                            <h5>التمهيد</h5>
                            <textarea id="lessonIntroduction" class="form-control" rows="4" placeholder="اكتب التمهيد للدرس..."></textarea>
                        </div>
                        <div class="lesson-section">
                            <h5>التمارين والتقييم</h5>
                            <div id="exercisesContainer">
                                <!-- سيتم إضافة التمارين هنا -->
                            </div>
                            <button type="button" class="btn btn-secondary" onclick="addExercise()">
                                <i class="fas fa-plus"></i> إضافة تمرين
                            </button>
                        </div>
                    </div>
                    
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" onclick="closeCreateLessonModal()">إلغاء</button>
                        <button type="submit" class="btn btn-success">حفظ الدرس</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- نموذج عرض تفاصيل المحتوى -->
    <div class="modal" id="contentDetailsModal">
        <div class="modal-content large">
            <div class="modal-header">
                <h3 id="contentModalTitle">تفاصيل المحتوى</h3>
                <button class="modal-close" onclick="closeContentDetailsModal()">&times;</button>
            </div>
            <div class="modal-body" id="contentDetailsBody">
                <!-- سيتم تعبئتها بواسطة JavaScript -->
            </div>
        </div>
    </div>

    <!-- النصوص والأيقونات -->
    <script src="../../assets/js/auth.js"></script>
    <script src="../../assets/js/teacher.js"></script>
    <script>
        // تهيئة الصفحة
        document.addEventListener('DOMContentLoaded', function() {
            initializeContentLibrary();
        });

        function initializeContentLibrary() {
            // التحقق من المصادقة
            const user = checkAuth();
            if (!user || user.role !== 'teacher') {
                window.location.href = '../../index.html';
                return;
            }

            // تحديث الواجهة
            document.getElementById('userName').textContent = user.name;
            document.getElementById('userAvatar').textContent = user.name.charAt(0);

            // تحميل المحتوى
            loadContent();
            
            // تهيئة الأحداث
            setupEventListeners();
        }

        function setupEventListeners() {
            // نموذج الاختبار
            document.getElementById('testForm')?.addEventListener('submit', function(e) {
                e.preventDefault();
                saveTest();
            });

            // نموذج الدرس
            document.getElementById('lessonForm')?.addEventListener('submit', function(e) {
                e.preventDefault();
                saveLesson();
            });
        }

        function loadContent() {
            const currentUser = getCurrentUser();
            
            // محاكاة البيانات
            setTimeout(() => {
                // تحديث الإحصائيات
                document.getElementById('totalTests').textContent = '12';
                document.getElementById('totalLessons').textContent = '24';
                document.getElementById('totalExercises').textContent = '36';
                document.getElementById('totalUsage').textContent = '148';

                // عرض الاختبارات
                displaySampleTests();
                displaySampleLessons();
                displaySampleExercises();
            }, 500);
        }

        function displaySampleTests() {
            const tests = [
                {
                    id: 1,
                    title: 'اختبار تشخيصي في القراءة',
                    subject: 'لغتي',
                    grade: 'الصف الثالث',
                    description: 'اختبار تشخيصي لمهارات القراءة الأساسية',
                    questions: 10,
                    usage: 8,
                    objectivesLinked: true
                },
                {
                    id: 2,
                    title: 'اختبار العمليات الحسابية',
                    subject: 'رياضيات',
                    grade: 'الصف الثاني',
                    description: 'اختبار في الجمع والطرح حتى 100',
                    questions: 15,
                    usage: 12,
                    objectivesLinked: true
                }
            ];

            const testsGrid = document.getElementById('testsGrid');
            testsGrid.innerHTML = tests.map(test => `
                <div class="content-card">
                    <div class="content-header">
                        <h4>${test.title}</h4>
                        <span class="content-badge subject-${test.subject}">${test.subject}</span>
                    </div>
                    <div class="content-body">
                        <p>${test.description}</p>
                        <div class="content-meta">
                            <span class="questions-count">${test.questions} سؤال</span>
                            <span class="total-grade">الصف ${test.grade}</span>
                            <span class="objectives-status ${test.objectivesLinked ? 'linked' : 'not-linked'}">
                                ${test.objectivesLinked ? 'مرتبط بأهداف' : 'غير مرتبط'}
                            </span>
                        </div>
                    </div>
                    <div class="content-actions">
                        <button class="btn btn-sm btn-primary" onclick="viewTest(${test.id})">عرض</button>
                        <button class="btn btn-sm btn-warning" onclick="editTest(${test.id})">تعديل</button>
                        <button class="btn btn-sm btn-success" onclick="assignTest(${test.id})">تعيين</button>
                        <button class="btn btn-sm btn-danger" onclick="deleteTest(${test.id})">حذف</button>
                    </div>
                </div>
            `).join('');
        }

        function displaySampleLessons() {
            const lessons = [
                {
                    id: 1,
                    title: 'درس الحروف المتصلة',
                    subject: 'لغتي',
                    grade: 'الصف الأول',
                    strategy: 'التعلم النشط',
                    description: 'درس تعليمي لربط الحروف في الكلمات',
                    exercises: 5,
                    priority: 'high',
                    objectivesLinked: true
                },
                {
                    id: 2,
                    title: 'درس الجمع البسيط',
                    subject: 'رياضيات',
                    grade: 'الصف الأول',
                    strategy: 'التعلم التعاوني',
                    description: 'درس تعليمي لعملية الجمع حتى 10',
                    exercises: 7,
                    priority: 'normal',
                    objectivesLinked: false
                }
            ];

            const lessonsGrid = document.getElementById('lessonsGrid');
            lessonsGrid.innerHTML = lessons.map(lesson => `
                <div class="content-card">
                    <div class="content-header">
                        <h4>${lesson.title}</h4>
                        <span class="content-badge subject-${lesson.subject}">${lesson.subject}</span>
                    </div>
                    <div class="content-body">
                        <p>${lesson.description}</p>
                        <div class="content-meta">
                            <span class="strategy">${lesson.strategy}</span>
                            <span class="priority">${lesson.priority === 'high' ? 'أولوية عالية' : 'عادية'}</span>
                            <span class="exercises-count">${lesson.exercises} تمرين</span>
                            <span class="objectives-status ${lesson.objectivesLinked ? 'linked' : 'not-linked'}">
                                ${lesson.objectivesLinked ? 'مرتبط بأهداف' : 'غير مرتبط'}
                            </span>
                        </div>
                    </div>
                    <div class="content-actions">
                        <button class="btn btn-sm btn-primary" onclick="viewLesson(${lesson.id})">عرض</button>
                        <button class="btn btn-sm btn-warning" onclick="editLesson(${lesson.id})">تعديل</button>
                        <button class="btn btn-sm btn-success" onclick="assignLesson(${lesson.id})">تعيين</button>
                        <button class="btn btn-sm btn-danger" onclick="deleteLesson(${lesson.id})">حذف</button>
                    </div>
                </div>
            `).join('');
        }

        function displaySampleExercises() {
            const exercises = [
                {
                    id: 1,
                    title: 'تمارين التهجئة',
                    subject: 'لغتي',
                    grade: 'الصف الثاني',
                    type: 'أنشطة كتابية',
                    description: 'تمارين تفاعلية للتهجئة الصحيحة',
                    usage: 15,
                    objectivesLinked: true
                },
                {
                    id: 2,
                    title: 'تمارين القياس',
                    subject: 'رياضيات',
                    grade: 'الصف الرابع',
                    type: 'أنشطة عملية',
                    description: 'تمارين في وحدات القياس المختلفة',
                    usage: 9,
                    objectivesLinked: true
                }
            ];

            const exercisesGrid = document.getElementById('exercisesGrid');
            exercisesGrid.innerHTML = exercises.map(exercise => `
                <div class="content-card">
                    <div class="content-header">
                        <h4>${exercise.title}</h4>
                        <span class="content-badge subject-${exercise.subject}">${exercise.subject}</span>
                    </div>
                    <div class="content-body">
                        <p>${exercise.description}</p>
                        <div class="content-meta">
                            <span class="strategy">${exercise.type}</span>
                            <span class="total-grade">الصف ${exercise.grade}</span>
                            <span class="exercises-count">${exercise.usage} استخدام</span>
                            <span class="objectives-status ${exercise.objectivesLinked ? 'linked' : 'not-linked'}">
                                ${exercise.objectivesLinked ? 'مرتبط بأهداف' : 'غير مرتبط'}
                            </span>
                        </div>
                    </div>
                    <div class="content-actions">
                        <button class="btn btn-sm btn-primary" onclick="viewExercise(${exercise.id})">عرض</button>
                        <button class="btn btn-sm btn-warning" onclick="editExercise(${exercise.id})">تعديل</button>
                        <button class="btn btn-sm btn-success" onclick="assignExercise(${exercise.id})">تعيين</button>
                        <button class="btn btn-sm btn-danger" onclick="deleteExercise(${exercise.id})">حذف</button>
                    </div>
                </div>
            `).join('');
        }

        // دوال عرض النماذج
        function showCreateTestModal() {
            document.getElementById('createTestModal').classList.add('show');
            document.getElementById('testForm').reset();
            document.getElementById('questionsContainer').innerHTML = '';
            addQuestion(); // إضافة سؤال أول افتراضي
        }

        function closeCreateTestModal() {
            document.getElementById('createTestModal').classList.remove('show');
        }

        function showCreateLessonModal() {
            document.getElementById('createLessonModal').classList.add('show');
            document.getElementById('lessonForm').reset();
            document.getElementById('exercisesContainer').innerHTML = '';
            addExercise(); // إضافة تمرين أول افتراضي
        }

        function closeCreateLessonModal() {
            document.getElementById('createLessonModal').classList.remove('show');
        }

        function showContentCreationModal() {
            // يمكنك جعل هذا زراً منسدلاً لاختيار نوع المحتوى
            const choice = prompt('اختر نوع المحتوى:\n1. اختبار\n2. درس\n3. تمرين');
            
            switch(choice) {
                case '1':
                    showCreateTestModal();
                    break;
                case '2':
                    showCreateLessonModal();
                    break;
                case '3':
                    alert('إنشاء التمرين قيد التطوير');
                    break;
                default:
                    // لا شيء
            }
        }

        // دوال إدارة الأسئلة والتمارين
        let questionCount = 0;
        let exerciseCount = 0;

        function addQuestion() {
            questionCount++;
            const container = document.getElementById('questionsContainer');
            const questionDiv = document.createElement('div');
            questionDiv.className = 'question-item';
            questionDiv.innerHTML = `
                <div class="question-header">
                    <h5>سؤال ${questionCount}</h5>
                    <button type="button" class="btn btn-sm btn-danger" onclick="removeQuestion(this)">حذف</button>
                </div>
                <div class="form-group">
                    <input type="text" class="form-control question-text" placeholder="نص السؤال" required>
                </div>
                <div class="form-group">
                    <select class="form-control question-type" required>
                        <option value="">نوع السؤال</option>
                        <option value="multiple-choice">اختيار من متعدد</option>
                        <option value="true-false">صح وخطأ</option>
                        <option value="short-answer">إجابة قصيرة</option>
                    </select>
                </div>
                <div class="choices-container" id="choices-${questionCount}" style="display: none;">
                    <div class="form-group">
                        <input type="text" class="form-control choice" placeholder="الاختيار ١">
                    </div>
                    <div class="form-group">
                        <input type="text" class="form-control choice" placeholder="الاختيار ٢">
                    </div>
                    <div class="form-group">
                        <input type="text" class="form-control choice" placeholder="الاختيار ٣">
                    </div>
                    <div class="form-group">
                        <input type="text" class="form-control choice" placeholder="الاختيار ٤">
                    </div>
                    <div class="form-group">
                        <label>الإجابة الصحيحة:</label>
                        <select class="form-control correct-choice">
                            <option value="1">الاختيار ١</option>
                            <option value="2">الاختيار ٢</option>
                            <option value="3">الاختيار ٣</option>
                            <option value="4">الاختيار ٤</option>
                        </select>
                    </div>
                </div>
            `;
            container.appendChild(questionDiv);

            // إظهار/إخفاء خيارات الاختيار من متعدد
            const typeSelect = questionDiv.querySelector('.question-type');
            typeSelect.addEventListener('change', function() {
                const choicesContainer = document.getElementById(`choices-${questionCount}`);
                choicesContainer.style.display = this.value === 'multiple-choice' ? 'block' : 'none';
            });
        }

        function removeQuestion(button) {
            button.closest('.question-item').remove();
            questionCount--;
            // إعادة ترقيم الأسئلة
            renumberQuestions();
        }

        function renumberQuestions() {
            const questions = document.querySelectorAll('.question-item');
            questions.forEach((question, index) => {
                question.querySelector('h5').textContent = `سؤال ${index + 1}`;
            });
            questionCount = questions.length;
        }

        function addExercise() {
            exerciseCount++;
            const container = document.getElementById('exercisesContainer');
            const exerciseDiv = document.createElement('div');
            exerciseDiv.className = 'exercise-item';
            exerciseDiv.innerHTML = `
                <div class="exercise-header">
                    <h5>تمرين ${exerciseCount}</h5>
                    <button type="button" class="btn btn-sm btn-danger" onclick="removeExercise(this)">حذف</button>
                </div>
                <div class="form-group">
                    <input type="text" class="form-control exercise-title" placeholder="عنوان التمرين" required>
                </div>
                <div class="form-group">
                    <textarea class="form-control exercise-content" rows="3" placeholder="وصف التمرين" required></textarea>
                </div>
                <div class="form-group">
                    <label>نوع التمرين:</label>
                    <select class="form-control exercise-type" required>
                        <option value="">اختر نوع التمرين</option>
                        <option value="written">كتابي</option>
                        <option value="oral">شفوي</option>
                        <option value="practical">عملي</option>
                        <option value="interactive">تفاعلي</option>
                    </select>
                </div>
            `;
            container.appendChild(exerciseDiv);
        }

        function removeExercise(button) {
            button.closest('.exercise-item').remove();
            exerciseCount--;
            renumberExercises();
        }

        function renumberExercises() {
            const exercises = document.querySelectorAll('.exercise-item');
            exercises.forEach((exercise, index) => {
                exercise.querySelector('h5').textContent = `تمرين ${index + 1}`;
            });
            exerciseCount = exercises.length;
        }

        // دوال الحفظ
        function saveTest() {
            const title = document.getElementById('testTitle').value.trim();
            const subject = document.getElementById('testSubject').value;
            const grade = document.getElementById('testGrade').value;
            const description = document.getElementById('testDescription').value.trim();

            if (!title || !subject || !grade) {
                showAuthNotification('يرجى ملء الحقول الإجبارية', 'error');
                return;
            }

            const questions = [];
            const questionItems = document.querySelectorAll('.question-item');
            
            if (questionItems.length === 0) {
                showAuthNotification('يرجى إضافة سؤال واحد على الأقل', 'error');
                return;
            }

            questionItems.forEach((item, index) => {
                const questionText = item.querySelector('.question-text').value.trim();
                const questionType = item.querySelector('.question-type').value;
                
                if (questionText && questionType) {
                    const question = {
                        id: index + 1,
                        text: questionText,
                        type: questionType
                    };

                    if (questionType === 'multiple-choice') {
                        const choices = item.querySelectorAll('.choice');
                        const correctChoice = item.querySelector('.correct-choice').value;
                        question.choices = Array.from(choices).map((choice, i) => ({
                            id: i + 1,
                            text: choice.value.trim()
                        }));
                        question.correctAnswer = parseInt(correctChoice);
                    }

                    questions.push(question);
                }
            });

            if (questions.length === 0) {
                showAuthNotification('يرجى إكمال بيانات جميع الأسئلة', 'error');
                return;
            }

            // محاكاة حفظ البيانات
            setTimeout(() => {
                showAuthNotification('تم حفظ الاختبار بنجاح', 'success');
                closeCreateTestModal();
                
                // إعادة تحميل المحتوى
                displaySampleTests();
                document.getElementById('totalTests').textContent = '13';
                
                // إضافة نشاط
                addTeacherActivity({
                    type: 'content',
                    title: 'أنشأت اختباراً جديداً',
                    description: title
                });
            }, 1500);
        }

        function saveLesson() {
            const title = document.getElementById('lessonTitle').value.trim();
            const strategy = document.getElementById('lessonStrategy').value;
            const subject = document.getElementById('lessonSubject').value;
            const grade = document.getElementById('lessonGrade').value;
            const description = document.getElementById('lessonDescription').value.trim();
            const introduction = document.getElementById('lessonIntroduction').value.trim();

            if (!title || !strategy || !subject || !grade) {
                showAuthNotification('يرجى ملء الحقول الإجبارية', 'error');
                return;
            }

            const exercises = [];
            const exerciseItems = document.querySelectorAll('.exercise-item');
            
            exerciseItems.forEach((item, index) => {
                const exerciseTitle = item.querySelector('.exercise-title').value.trim();
                const exerciseContent = item.querySelector('.exercise-content').value.trim();
                const exerciseType = item.querySelector('.exercise-type').value;
                
                if (exerciseTitle && exerciseContent && exerciseType) {
                    exercises.push({
                        id: index + 1,
                        title: exerciseTitle,
                        content: exerciseContent,
                        type: exerciseType
                    });
                }
            });

            // محاكاة حفظ البيانات
            setTimeout(() => {
                showAuthNotification('تم حفظ الدرس بنجاح', 'success');
                closeCreateLessonModal();
                
                // إعادة تحميل المحتوى
                displaySampleLessons();
                document.getElementById('totalLessons').textContent = '25';
                
                // إضافة نشاط
                addTeacherActivity({
                    type: 'content',
                    title: 'أنشأت درساً جديداً',
                    description: title
                });
            }, 1500);
        }

        // دوال العرض
        function viewTest(testId) {
            // محاكاة عرض الاختبار
            document.getElementById('contentModalTitle').textContent = 'تفاصيل الاختبار';
            document.getElementById('contentDetailsBody').innerHTML = `
                <div class="test-info-card">
                    <h4>اختبار تشخيصي في القراءة</h4>
                    <div class="test-details">
                        <p><strong>المادة:</strong> لغتي</p>
                        <p><strong>الصف:</strong> الصف الثالث</p>
                        <p><strong>عدد الأسئلة:</strong> 10</p>
                        <p><strong>مرات الاستخدام:</strong> 8</p>
                        <p><strong>الوصف:</strong> اختبار تشخيصي لمهارات القراءة الأساسية</p>
                    </div>
                    <div class="test-actions">
                        <button class="btn btn-primary">عرض الأسئلة</button>
                        <button class="btn btn-success">تعيين للطلاب</button>
                        <button class="btn btn-warning">تعديل</button>
                    </div>
                </div>
            `;
            document.getElementById('contentDetailsModal').classList.add('show');
        }

        function viewLesson(lessonId) {
            // محاكاة عرض الدرس
            document.getElementById('contentModalTitle').textContent = 'تفاصيل الدرس';
            document.getElementById('contentDetailsBody').innerHTML = `
                <div class="lesson-info-card">
                    <h4>درس الحروف المتصلة</h4>
                    <div class="lesson-details">
                        <p><strong>المادة:</strong> لغتي</p>
                        <p><strong>الصف:</strong> الصف الأول</p>
                        <p><strong>الاستراتيجية:</strong> التعلم النشط</p>
                        <p><strong>عدد التمارين:</strong> 5</p>
                        <p><strong>الوصف:</strong> درس تعليمي لربط الحروف في الكلمات</p>
                    </div>
                    <h5>التمهيد:</h5>
                    <p>يبدأ الدرس بسرد قصة قصيرة تتضمن الكلمات المستهدفة...</p>
                    <div class="lesson-actions">
                        <button class="btn btn-primary">عرض التمارين</button>
                        <button class="btn btn-success">تعيين للطلاب</button>
                        <button class="btn btn-warning">تعديل</button>
                    </div>
                </div>
            `;
            document.getElementById('contentDetailsModal').classList.add('show');
        }

        function closeContentDetailsModal() {
            document.getElementById('contentDetailsModal').classList.remove('show');
        }

        // دوال البحث والتصفية
        function searchContent() {
            const searchTerm = document.getElementById('contentSearch').value.toLowerCase();
            const contentCards = document.querySelectorAll('.content-card');
            
            contentCards.forEach(card => {
                const title = card.querySelector('h4').textContent.toLowerCase();
                const description = card.querySelector('p').textContent.toLowerCase();
                
                if (title.includes(searchTerm) || description.includes(searchTerm)) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        function filterContentByType(type) {
            // تحديث أزرار التصفية
            document.querySelectorAll('.type-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // تصفية المحتوى
            filterContent();
        }

        function filterContent() {
            const type = document.querySelector('.type-btn.active').textContent;
            const subject = document.getElementById('subjectFilter').value;
            const grade = document.getElementById('gradeFilter').value;
            
            const contentCards = document.querySelectorAll('.content-card');
            
            contentCards.forEach(card => {
                const cardSubject = card.querySelector('.content-badge').textContent;
                const cardGrade = card.querySelector('.total-grade')?.textContent || '';
                
                let showCard = true;
                
                // تصفية حسب النوع (اختبارات/دروس/تمارين)
                if (type !== 'الكل') {
                    const section = card.closest('.library-section');
                    const sectionTitle = section.querySelector('h2').textContent;
                    
                    const typeMap = {
                        'اختبارات': 'اختبارات',
                        'دروس': 'دروس',
                        'تمارين': 'تمارين'
                    };
                    
                    if (type !== typeMap[sectionTitle]) {
                        showCard = false;
                    }
                }
                
                // تصفية حسب المادة
                if (subject !== 'all' && cardSubject !== subject) {
                    showCard = false;
                }
                
                // تصفية حسب الصف
                if (grade !== 'all' && !cardGrade.includes(grade)) {
                    showCard = false;
                }
                
                card.style.display = showCard ? 'block' : 'none';
            });
        }

        // دوال المساعدة
        function addTeacherActivity(activity) {
            // محاكاة إضافة نشاط
            console.log('نشاط المعلم:', activity);
        }

        function showNotifications() {
            alert('نظام الإشعارات قيد التطوير');
        }

        function toggleSidebar() {
            document.querySelector('.sidebar').classList.toggle('active');
        }

        // تصدير الدوال للاستخدام العالمي
        window.showCreateTestModal = showCreateTestModal;
        window.closeCreateTestModal = closeCreateTestModal;
        window.showCreateLessonModal = showCreateLessonModal;
        window.closeCreateLessonModal = closeCreateLessonModal;
        window.showContentCreationModal = showContentCreationModal;
        window.addQuestion = addQuestion;
        window.removeQuestion = removeQuestion;
        window.addExercise = addExercise;
        window.removeExercise = removeExercise;
        window.saveTest = saveTest;
        window.saveLesson = saveLesson;
        window.viewTest = viewTest;
        window.viewLesson = viewLesson;
        window.closeContentDetailsModal = closeContentDetailsModal;
        window.searchContent = searchContent;
        window.filterContentByType = filterContentByType;
        window.filterContent = filterContent;
        window.showNotifications = showNotifications;
        window.toggleSidebar = toggleSidebar;
        window.editTest = viewTest; // مؤقتاً
        window.editLesson = viewLesson; // مؤقتاً
        window.assignTest = function(id) {
            alert('تعيين الاختبار للطلاب - قيد التطوير');
        };
        window.assignLesson = function(id) {
            alert('تعيين الدرس للطلاب - قيد التطوير');
        };
        window.assignExercise = function(id) {
            alert('تعيين التمرين للطلاب - قيد التطوير');
        };
        window.deleteTest = function(id) {
            if (confirm('هل أنت متأكد من حذف هذا الاختبار؟')) {
                showAuthNotification('تم حذف الاختبار', 'success');
            }
        };
        window.deleteLesson = function(id) {
            if (confirm('هل أنت متأكد من حذف هذا الدرس؟')) {
                showAuthNotification('تم حذف الدرس', 'success');
            }
        };
        window.deleteExercise = function(id) {
            if (confirm('هل أنت متأكد من حذف هذا التمرين؟')) {
                showAuthNotification('تم حذف التمرين', 'success');
            }
        };
        window.viewExercise = function(id) {
            document.getElementById('contentModalTitle').textContent = 'تفاصيل التمرين';
            document.getElementById('contentDetailsBody').innerHTML = `
                <div class="exercise-info-card">
                    <h4>تمارين التهجئة</h4>
                    <div class="exercise-details">
                        <p><strong>المادة:</strong> لغتي</p>
                        <p><strong>الصف:</strong> الصف الثاني</p>
                        <p><strong>نوع التمرين:</strong> أنشطة كتابية</p>
                        <p><strong>مرات الاستخدام:</strong> 15</p>
                        <p><strong>الوصف:</strong> تمارين تفاعلية للتهجئة الصحيحة</p>
                    </div>
                    <div class="exercise-actions">
                        <button class="btn btn-primary">عرض التفاصيل</button>
                        <button class="btn btn-success">تعيين للطلاب</button>
                        <button class="btn btn-warning">تعديل</button>
                    </div>
                </div>
            `;
            document.getElementById('contentDetailsModal').classList.add('show');
        };
        window.editExercise = function(id) {
            alert('تعديل التمرين - قيد التطوير');
        };
    </script>
</body>
</html>
