<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุงูุงุฎุชุจุงุฑุงุช ุงูุชุดุฎูุตูุฉ - ููุณุฑ ุงูุชุนูู</title>
    <!-- ุงุณุชุฎุฏุงู ุงูุฃููุงุท ุงูุฃุตููุฉ -->
    <link rel="stylesheet" href="../../assets/css/main.css">
    <link rel="stylesheet" href="../../assets/css/teacher.css">
    <link rel="stylesheet" href="../../assets/css/diagnostic-tests.css">
    <style>
        /* ุฃููุงุท ุฅุถุงููุฉ ุตุบูุฑุฉ ููุท */
        .test-subject-badge {
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 500;
        }
        
        .subject-arabic {
            background: #e3f2fd;
            color: #1976d2;
        }
        
        .subject-math {
            background: #f3e5f5;
            color: #7b1fa2;
        }
        
        .objectives-status {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 500;
        }
        
        .status-linked {
            background: var(--success-color);
            color: white;
        }
        
        .status-not-linked {
            background: var(--warning-color);
            color: white;
        }
        
        /* ูุถูุงู ุนุฑุถ ุงูุดุฑูุท ุงูุฌุงูุจู ุจุดูู ุตุญูุญ */
        .dashboard-container {
            display: flex;
            min-height: 100vh;
            background-color: #f8f9fa;
        }
        
        .sidebar {
            width: 280px;
            background: var(--secondary-color);
            color: white;
            position: fixed;
            right: 0;
            top: 0;
            height: 100vh;
            overflow-y: auto;
            transition: all 0.3s ease;
            z-index: 1000;
        }
        
        .main-content-dashboard {
            flex: 1;
            margin-right: 280px;
            transition: all 0.3s ease;
        }
        
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(100%);
            }
            
            .sidebar.active {
                transform: translateX(0);
            }
            
            .main-content-dashboard {
                margin-right: 0;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <!-- ุงูุดุฑูุท ุงูุฌุงูุจู -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <h2>ููุณุฑ ุงูุชุนูู</h2>
                </div>
            </div>
            <ul class="sidebar-menu">
                <li><a href="dashboard.html">๐ ููุญุฉ ุงูุชุญูู</a></li>
                <li><a href="diagnostic-tests.html" class="active">๐ ุงูุงุฎุชุจุงุฑุงุช ุงูุชุดุฎูุตูุฉ</a></li>
                <li><a href="students.html">๐จโ๐ ุงูุทูุงุจ</a></li>
                <li><a href="library.html">๐ ููุชุจุฉ ุงููุญุชูู</a></li>
                <li><a href="committee.html">๐ฅ ุงููุฌูุฉ</a></li>
                <li><a href="#" onclick="logout()">๐ช ุชุณุฌูู ุงูุฎุฑูุฌ</a></li>
            </ul>
        </div>

        <!-- ุงููุญุชูู ุงูุฑุฆูุณู -->
        <div class="main-content-dashboard">
            <header class="dashboard-header">
                <div class="user-info">
                    <div class="user-welcome">
                        <div class="welcome-text">ูุฑุญุจุงู</div>
                        <div class="user-name" id="userName"></div>
                    </div>
                    <div class="user-avatar" id="userAvatar"></div>
                </div>
            </header>

            <main class="dashboard-content">
                <div class="content-header">
                    <h1>๐ ุงูุงุฎุชุจุงุฑุงุช ุงูุชุดุฎูุตูุฉ</h1>
                </div>

                <div class="diagnostic-tests-container">
                    <!-- ุฃุฒุฑุงุฑ ุงูุฅุฌุฑุงุกุงุช ุงูุณุฑูุนุฉ -->
                    <div class="tests-actions">
                        <button class="btn btn-success btn-lg" onclick="showCreateTestModal()">
                            ๐ ุฅูุดุงุก ุงุฎุชุจุงุฑ ุชุดุฎูุตู ุฌุฏูุฏ
                        </button>
                        <button class="btn btn-primary btn-lg" onclick="showImportTestModal()">
                            ๐ ุงุณุชูุฑุงุฏ ุงุฎุชุจุงุฑ
                        </button>
                    </div>

                    <!-- ูุงุฆูุฉ ุงูุงุฎุชุจุงุฑุงุช ุญุณุจ ุงููุงุฏุฉ -->
                    <div class="tests-list">
                        <!-- ุงุฎุชุจุงุฑุงุช ูุงุฏุฉ ูุบุชู -->
                        <div class="subject-section">
                            <div class="subject-header">
                                <span class="subject-icon">๐</span>
                                <h3>ุงุฎุชุจุงุฑุงุช ูุงุฏุฉ ูุบุชู</h3>
                            </div>
                            <div id="arabicTestsList" class="subject-tests">
                                <!-- ุณูุชู ุชุนุจุฆุชู ุจุงูุฌุงูุงุณูุฑูุจุช -->
                            </div>
                        </div>

                        <!-- ุงุฎุชุจุงุฑุงุช ูุงุฏุฉ ุงูุฑูุงุถูุงุช -->
                        <div class="subject-section">
                            <div class="subject-header">
                                <span class="subject-icon">๐ข</span>
                                <h3>ุงุฎุชุจุงุฑุงุช ูุงุฏุฉ ุงูุฑูุงุถูุงุช</h3>
                            </div>
                            <div id="mathTestsList" class="subject-tests">
                                <!-- ุณูุชู ุชุนุจุฆุชู ุจุงูุฌุงูุงุณูุฑูุจุช -->
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- ูุงูุฐุฉ ุฅูุดุงุก ุงุฎุชุจุงุฑ ุฌุฏูุฏ -->
    <div id="createTestModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ุฅูุดุงุก ุงุฎุชุจุงุฑ ุชุดุฎูุตู ุฌุฏูุฏ</h3>
                <button class="modal-close" onclick="closeCreateTestModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="createTestForm">
                    <div class="form-group">
                        <label for="testTitle">ุนููุงู ุงูุงุฎุชุจุงุฑ *</label>
                        <input type="text" id="testTitle" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="testSubject">ุงููุงุฏุฉ *</label>
                        <select id="testSubject" class="form-control" required>
                            <option value="">ุงุฎุชุฑ ุงููุงุฏุฉ</option>
                            <option value="ูุบุชู">ูุบุชู</option>
                            <option value="ุฑูุงุถูุงุช">ุฑูุงุถูุงุช</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="testDescription">ูุตู ุงูุงุฎุชุจุงุฑ (ุงุฎุชูุงุฑู)</label>
                        <textarea id="testDescription" class="form-control" rows="3"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeCreateTestModal()">ุฅูุบุงุก</button>
                <button class="btn btn-success" onclick="createNewTest()">ุฅูุดุงุก</button>
            </div>
        </div>
    </div>

    <!-- ูุงูุฐุฉ ุงุณุชูุฑุงุฏ ุงุฎุชุจุงุฑ -->
    <div id="importTestModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ุงุณุชูุฑุงุฏ ุงุฎุชุจุงุฑ ุชุดุฎูุตู</h3>
                <button class="modal-close" onclick="closeImportTestModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="import-export-section">
                    <div class="file-upload-box" onclick="document.getElementById('importFile').click()">
                        <div class="upload-icon">๐</div>
                        <p>ุงููุฑ ูุงุฎุชูุงุฑ ููู ุงูุงุฎุชุจุงุฑ ุฃู ุงุณุญุจ ุงูููู ููุง</p>
                        <input type="file" id="importFile" style="display: none;" accept=".json">
                    </div>
                    <p><small>ููุงุญุธุฉ: ุจุนุฏ ุงูุงุณุชูุฑุงุฏ ูุฌุจ ุฑุจุท ุงูุฃุณุฆูุฉ ุจุงูุฃูุฏุงู ุงููุตูุฑุฉ</small></p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeImportTestModal()">ุฅูุบุงุก</button>
                <button class="btn btn-success" onclick="importTest()">ุงุณุชูุฑุงุฏ</button>
            </div>
        </div>
    </div>

    <!-- ูุงูุฐุฉ ุนุฑุถ ุชูุงุตูู ุงูุงุฎุชุจุงุฑ -->
    <div id="viewTestModal" class="modal">
        <div class="modal-content large">
            <div class="modal-header">
                <h3 id="viewTestTitle">ุนููุงู ุงูุงุฎุชุจุงุฑ</h3>
                <button class="modal-close" onclick="closeViewTestModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="test-details">
                    <p><strong>ุงููุงุฏุฉ:</strong> <span id="viewTestSubject"></span></p>
                    <p><strong>ุงููุตู:</strong> <span id="viewTestDescription"></span></p>
                    <p><strong>ุนุฏุฏ ุงูุฃุณุฆูุฉ:</strong> <span id="viewTestQuestionsCount"></span></p>
                    <p><strong>ูุญู ุงูุงุฌุชูุงุฒ:</strong> <span id="viewTestPassCriteria"></span></p>
                    <p><strong>ุชุงุฑูุฎ ุงูุฅูุดุงุก:</strong> <span id="viewTestCreatedAt"></span></p>
                </div>
                <div class="questions-preview">
                    <h4>ุงูุฃุณุฆูุฉ:</h4>
                    <div id="viewTestQuestions"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeViewTestModal()">ุฅุบูุงู</button>
            </div>
        </div>
    </div>

    <!-- ูุงูุฐุฉ ุฑุจุท ุงูุฃูุฏุงู -->
    <div id="linkObjectivesModal" class="modal">
        <div class="modal-content large">
            <div class="modal-header">
                <h3>ุฑุจุท ุงูุฃุณุฆูุฉ ุจุงูุฃูุฏุงู ุงููุตูุฑุฉ</h3>
                <button class="modal-close" onclick="closeLinkObjectivesModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="linking-progress">
                    <h4 id="linkingProgress"></h4>
                    <div class="current-question">
                        <h5>ุงูุณุคุงู ุงูุญุงูู:</h5>
                        <p id="linkingQuestionText"></p>
                    </div>
                    <div class="objectives-linking">
                        <h5>ุงุฎุชุฑ ูุฏู ูุตูุฑ ููุฐุง ุงูุณุคุงู:</h5>
                        <div id="objectivesList"></div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeLinkObjectivesModal()">ุฅูุบุงุก</button>
                <button class="btn btn-success" onclick="nextQuestionForLinking()">ุงูุชุงูู</button>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="../../assets/js/auth.js"></script>
    <script>
        // ุฏุงูุฉ ุฅุดุนุงุฑ ุจุณูุทุฉ
        function showAuthNotification(message, type = 'info') {
            alert(type.toUpperCase() + ': ' + message);
        }
        
        // ุฏุงูุฉ ุชูููุฏ ูุนุฑู
        function generateId() {
            return Math.floor(Math.random() * 1000000) + 1;
        }
        
        // ุฏุงูุฉ ุงูุชุญูู ูู ุงููุตุงุฏูุฉ (ูุจุณุทุฉ)
        function checkAuth() {
            return {
                id: 1,
                name: 'ุงููุนูู ุงูุชุฌุฑูุจู',
                role: 'teacher'
            };
        }
        
        // ุฏุงูุฉ ุชุณุฌูู ุงูุฎุฑูุฌ
        function logout() {
            if (confirm('ูู ุชุฑูุฏ ุชุณุฌูู ุงูุฎุฑูุฌุ')) {
                window.location.href = '../../index.html';
            }
        }
        
        // ุฏุงูุฉ ุชูุณูู ุงูุชุงุฑูุฎ
        function formatDate(dateString) {
            if (!dateString) return 'ุบูุฑ ูุญุฏุฏ';
            const date = new Date(dateString);
            return date.toLocaleDateString('ar-SA') + ' ' + date.toLocaleTimeString('ar-SA');
        }
        
        // ุฏุงูุฉ ุชูุณูู ุงูุชุงุฑูุฎ ุงููุฎุชุตุฑ
        function formatDateShort(dateString) {
            if (!dateString) return 'ุบูุฑ ูุญุฏุฏ';
            const date = new Date(dateString);
            return date.toLocaleDateString('ar-SA');
        }
        
        // ุฏูุงู ุงูุชุฎุฒูู ุงููุญูู
        function getDiagnosticTests() {
            return JSON.parse(localStorage.getItem('diagnosticTests') || '[]');
        }
        
        function getDiagnosticTestById(id) {
            const tests = getDiagnosticTests();
            return tests.find(test => test.id === id);
        }
        
        function saveDiagnosticTest(test) {
            const tests = getDiagnosticTests();
            const index = tests.findIndex(t => t.id === test.id);
            
            if (index >= 0) {
                tests[index] = test;
            } else {
                tests.push(test);
            }
            
            localStorage.setItem('diagnosticTests', JSON.stringify(tests));
            return test;
        }
        
        // ุฏุงูุฉ ูุชุญููู ุงูุงุฎุชุจุงุฑุงุช
        function loadDiagnosticTests() {
            const tests = getDiagnosticTests();
            const arabicTests = tests.filter(test => test.subject === 'ูุบุชู');
            const mathTests = tests.filter(test => test.subject === 'ุฑูุงุถูุงุช');
            
            displayTestsBySubject('arabicTestsList', arabicTests, '๐', 'ูุบุชู');
            displayTestsBySubject('mathTestsList', mathTests, '๐ข', 'ุฑูุงุถูุงุช');
        }
        
        function displayTestsBySubject(containerId, tests, icon, subjectName) {
            const container = document.getElementById(containerId);
            
            if (!container) return;
            
            if (tests.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">${icon}</div>
                        <h3>ูุง ุชูุฌุฏ ุงุฎุชุจุงุฑุงุช ููุงุฏุฉ ${subjectName}</h3>
                        <p>ูู ุจุฅูุดุงุก ุฃูู ุงุฎุชุจุงุฑ ุชุดุฎูุตู</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = tests.map(test => {
                const objectivesStatus = test.objectivesLinked ? 
                    '<span class="objectives-status status-linked">ุชู ุงูุฑุจุท</span>' :
                    '<span class="objectives-status status-not-linked">ูู ูุชู ุงูุฑุจุท</span>';
                
                return `
                    <div class="test-card">
                        <div class="test-header">
                            <div class="test-title">${test.title}</div>
                            <div class="test-meta">
                                <span class="test-subject-badge ${test.subject === 'ูุบุชู' ? 'subject-arabic' : 'subject-math'}">
                                    ${test.subject}
                                </span>
                                ${objectivesStatus}
                                <span>${formatDateShort(test.createdAt)}</span>
                            </div>
                        </div>
                        ${test.description ? `<p>${test.description}</p>` : ''}
                        <div class="test-actions">
                            <button class="btn btn-sm btn-primary" onclick="viewTest(${test.id})">
                                ุนุฑุถ
                            </button>
                            <button class="btn btn-sm btn-warning" onclick="editTest(${test.id})">
                                ุชุนุฏูู
                            </button>
                            <button class="btn btn-sm btn-info" onclick="linkObjectives(${test.id})">
                                ุฑุจุท ุงูุฃูุฏุงู
                            </button>
                            <button class="btn btn-sm btn-secondary" onclick="exportTest(${test.id})">
                                ุชุตุฏูุฑ
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="deleteTest(${test.id})">
                                ุญุฐู
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        // ุฏูุงู ุงูููุงูุฐ ุงูููุจุซูุฉ
        function showCreateTestModal() {
            console.log('ูุชุญ ูุงูุฐุฉ ุฅูุดุงุก ุงุฎุชุจุงุฑ');
            document.getElementById('createTestModal').classList.add('show');
        }
        
        function closeCreateTestModal() {
            document.getElementById('createTestModal').classList.remove('show');
            document.getElementById('createTestForm').reset();
        }
        
        function showImportTestModal() {
            document.getElementById('importTestModal').classList.add('show');
        }
        
        function closeImportTestModal() {
            document.getElementById('importTestModal').classList.remove('show');
        }
        
        function closeViewTestModal() {
            document.getElementById('viewTestModal').classList.remove('show');
        }
        
        function closeLinkObjectivesModal() {
            document.getElementById('linkObjectivesModal').classList.remove('show');
        }
        
        // ุฏุงูุฉ ุฅูุดุงุก ุงุฎุชุจุงุฑ ุฌุฏูุฏ
        function createNewTest() {
            const title = document.getElementById('testTitle').value.trim();
            const subject = document.getElementById('testSubject').value;
            const description = document.getElementById('testDescription').value.trim();
            
            console.log('ุจูุงูุงุช ุงููููุฐุฌ:', { title, subject, description });
            
            if (!title || !subject) {
                showAuthNotification('ูุฑุฌู ุฅุฏุฎุงู ุนููุงู ุงูุงุฎุชุจุงุฑ ูุชุญุฏูุฏ ุงููุงุฏุฉ', 'error');
                return;
            }
            
            const test = {
                id: generateId(),
                title: title,
                subject: subject,
                description: description,
                questions: [],
                passCriteria: 70,
                objectivesLinked: false,
                createdAt: new Date().toISOString(),
                createdBy: checkAuth().id
            };
            
            console.log('ุงูุงุฎุชุจุงุฑ ุงูุฐู ุณูุชู ุญูุธู:', test);
            
            const savedTest = saveDiagnosticTest(test);
            console.log('ุชู ุญูุธ ุงูุงุฎุชุจุงุฑ:', savedTest);
            
            showAuthNotification('ุชู ุฅูุดุงุก ุงูุงุฎุชุจุงุฑ ุจูุฌุงุญ', 'success');
            closeCreateTestModal();
            
            // ุชุญููู ุงูุงุฎุชุจุงุฑุงุช ูุฑุฉ ุฃุฎุฑู
            loadDiagnosticTests();
            
            // ุงูุงูุชูุงู ุฅูู ุตูุญุฉ ุงูุชุญุฑูุฑ ุจุนุฏ ุซุงููุฉ
            setTimeout(() => {
                editTest(savedTest.id);
            }, 1000);
        }
        
        // ุฏุงูุฉ ุงูุชุนุฏูู
        function editTest(testId) {
            console.log('ุชุนุฏูู ุงูุงุฎุชุจุงุฑ:', testId);
            window.location.href = `test-editor.html?id=${testId}`;
        }
        
        // ุฏุงูุฉ ุนุฑุถ ุงูุงุฎุชุจุงุฑ
        function viewTest(testId) {
            const test = getDiagnosticTestById(testId);
            if (!test) {
                showAuthNotification('ุงูุงุฎุชุจุงุฑ ุบูุฑ ููุฌูุฏ', 'error');
                return;
            }
            
            document.getElementById('viewTestTitle').textContent = test.title;
            document.getElementById('viewTestSubject').textContent = test.subject;
            document.getElementById('viewTestDescription').textContent = test.description || 'ูุง ููุฌุฏ ูุตู';
            document.getElementById('viewTestQuestionsCount').textContent = test.questions?.length || 0;
            document.getElementById('viewTestPassCriteria').textContent = test.passCriteria + '%';
            document.getElementById('viewTestCreatedAt').textContent = formatDate(test.createdAt);
            
            const questionsList = document.getElementById('viewTestQuestions');
            if (test.questions && test.questions.length > 0) {
                questionsList.innerHTML = test.questions.map((q, index) => `
                    <div class="question-preview">
                        <div class="question-header">
                            <h5>ุงูุณุคุงู ${index + 1}</h5>
                        </div>
                        <div class="question-content">
                            <p>${q.text}</p>
                        </div>
                    </div>
                `).join('');
            } else {
                questionsList.innerHTML = '<p>ูุง ุชูุฌุฏ ุฃุณุฆูุฉ ูู ูุฐุง ุงูุงุฎุชุจุงุฑ</p>';
            }
            
            document.getElementById('viewTestModal').classList.add('show');
        }
        
        // ุฏุงูุฉ ุฑุจุท ุงูุฃูุฏุงู (ูุจุณุทุฉ)
        function linkObjectives(testId) {
            const test = getDiagnosticTestById(testId);
            if (!test || !test.questions || test.questions.length === 0) {
                showAuthNotification('ูุฌุจ ุฃู ูุญุชูู ุงูุงุฎุชุจุงุฑ ุนูู ุฃุณุฆูุฉ ุฃููุงู', 'error');
                return;
            }
            
            showAuthNotification('ูุฌุจ ุฃู ุชุฐูุจ ูุตูุญุฉ ุงูุชุญุฑูุฑ ูุฑุจุท ุงูุฃูุฏุงู', 'info');
            editTest(testId);
        }
        
        // ุฏุงูุฉ ุงูุชุตุฏูุฑ (ูุจุณุทุฉ)
        function exportTest(testId) {
            const test = getDiagnosticTestById(testId);
            if (!test) return;
            
            // ุฅุฒุงูุฉ ุงูุฃูุฏุงู ุงููุฑุจูุทุฉ ุนูุฏ ุงูุชุตุฏูุฑ
            const exportData = {
                ...test,
                objectivesLinked: false,
                linkedObjectives: {}
            };
            
            const blob = new Blob([JSON.stringify(exportData, null, 2)], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `test-${test.id}-${test.title}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showAuthNotification('ุชู ุชุตุฏูุฑ ุงูุงุฎุชุจุงุฑ ุจูุฌุงุญ', 'success');
        }
        
        // ุฏุงูุฉ ุงูุญุฐู
        function deleteTest(testId) {
            if (!confirm('ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ูุฐุง ุงูุงุฎุชุจุงุฑุ')) {
                return;
            }
            
            const tests = getDiagnosticTests();
            const updatedTests = tests.filter(test => test.id !== testId);
            
            localStorage.setItem('diagnosticTests', JSON.stringify(updatedTests));
            
            showAuthNotification('ุชู ุญุฐู ุงูุงุฎุชุจุงุฑ ุจูุฌุงุญ', 'success');
            loadDiagnosticTests();
        }
        
        // ุฏุงูุฉ ุงูุงุณุชูุฑุงุฏ
        async function importTest() {
            const fileInput = document.getElementById('importFile');
            const file = fileInput.files[0];
            
            if (!file) {
                showAuthNotification('ูุฑุฌู ุงุฎุชูุงุฑ ููู ููุงุณุชูุฑุงุฏ', 'error');
                return;
            }
            
            try {
                const text = await readFileAsText(file);
                const importedTest = JSON.parse(text);
                
                // ุชุนุฏูู ุงูุจูุงูุงุช
                importedTest.id = generateId();
                importedTest.createdAt = new Date().toISOString();
                importedTest.createdBy = checkAuth().id;
                importedTest.objectivesLinked = false;
                importedTest.linkedObjectives = {};
                
                saveDiagnosticTest(importedTest);
                
                showAuthNotification('ุชู ุงุณุชูุฑุงุฏ ุงูุงุฎุชุจุงุฑ ุจูุฌุงุญ', 'success');
                closeImportTestModal();
                loadDiagnosticTests();
                
                setTimeout(() => {
                    showAuthNotification('ูุฑุฌู ุฑุจุท ุฃุณุฆูุฉ ุงูุงุฎุชุจุงุฑ ุจุงูุฃูุฏุงู ุงููุตูุฑุฉ', 'warning');
                }, 1000);
                
            } catch (error) {
                showAuthNotification('ุฎุทุฃ ูู ุชูุณูู ุงูููู', 'error');
                console.error(error);
            }
        }
        
        function readFileAsText(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = e => resolve(e.target.result);
                reader.onerror = e => reject(e);
                reader.readAsText(file);
            });
        }
        
        // ุฏุงูุฉ ุงูุฑุจุท
        function nextQuestionForLinking() {
            showAuthNotification('ูุฐู ูุธููุฉ ุณูุชู ุชูููุฐูุง ูู ุตูุญุฉ ุงูุชุญุฑูุฑ', 'info');
        }
        
        // ุชููุฆุฉ ุงูุตูุญุฉ
        document.addEventListener('DOMContentLoaded', function() {
            const user = checkAuth();
            if (!user || user.role !== 'teacher') {
                window.location.href = '../../index.html';
                return;
            }
            
            document.getElementById('userName').textContent = user.name;
            document.getElementById('userAvatar').textContent = user.name.charAt(0);
            
            loadDiagnosticTests();
            
            console.log('โ ุตูุญุฉ ุงูุงุฎุชุจุงุฑุงุช ุงูุชุดุฎูุตูุฉ ุฌุงูุฒุฉ');
        });
    </script>
</body>
</html>
