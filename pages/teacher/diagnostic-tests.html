<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„ØªØ´Ø®ÙŠØµÙŠØ© - Ù…ÙŠØ³Ø± Ø§Ù„ØªØ¹Ù„Ù…</title>
    <link rel="stylesheet" href="../../assets/css/main.css">
    <link rel="stylesheet" href="../../assets/css/teacher.css">
    <link rel="stylesheet" href="../../assets/css/diagnostic-tests.css">
    <style>
        /* Ø£Ù†Ù…Ø§Ø· Ø¥Ø¶Ø§ÙÙŠØ© */
        .dashboard-container {
            display: flex;
            min-height: 100vh;
        }
        
        .sidebar {
            width: 250px;
            background: var(--secondary-color);
            color: white;
            position: fixed;
            right: 0;
            top: 0;
            height: 100vh;
            overflow-y: auto;
        }
        
        .sidebar-header {
            padding: 20px;
            background: rgba(0,0,0,0.1);
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .sidebar-header .logo h2 {
            color: white;
            margin: 0;
            text-align: center;
        }
        
        .sidebar-menu {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .sidebar-menu li {
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        
        .sidebar-menu a {
            display: block;
            padding: 15px 20px;
            color: rgba(255,255,255,0.8);
            text-decoration: none;
            transition: all 0.3s ease;
        }
        
        .sidebar-menu a:hover,
        .sidebar-menu a.active {
            background: rgba(255,255,255,0.1);
            color: white;
            border-right: 3px solid var(--primary-color);
        }
        
        .main-content-dashboard {
            flex: 1;
            margin-right: 250px;
        }
        
        .dashboard-header {
            background: white;
            padding: 15px 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            background: var(--primary-color);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        .dashboard-content {
            padding: 30px;
        }
        
        .content-header {
            margin-bottom: 30px;
        }
        
        .content-header h1 {
            color: var(--secondary-color);
            font-size: 1.8rem;
        }
        
        .test-subject-badge {
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 500;
        }
        
        .subject-arabic {
            background: #e3f2fd;
            color: #1976d2;
        }
        
        .subject-math {
            background: #f3e5f5;
            color: #7b1fa2;
        }
        
        .objectives-status {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 500;
        }
        
        .status-linked {
            background: var(--success-color);
            color: white;
        }
        
        .status-not-linked {
            background: var(--warning-color);
            color: white;
        }
        
        /* Ø§Ù„Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© */
        :root {
            --primary-color: #3498db;
            --secondary-color: #2c3e50;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
            --light-color: #ecf0f1;
            --border-color: #bdc3c7;
            --shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            font-family: 'Tajawal', sans-serif;
        }
        
        .btn-primary {
            background: var(--primary-color);
            color: white;
        }
        
        .btn-secondary {
            background: var(--secondary-color);
            color: white;
        }
        
        .btn-success {
            background: var(--success-color);
            color: white;
        }
        
        .btn-danger {
            background: var(--danger-color);
            color: white;
        }
        
        .btn-warning {
            background: var(--warning-color);
            color: white;
        }
        
        .btn-info {
            background: #17a2b8;
            color: white;
        }
        
        .btn-lg {
            padding: 15px 30px;
            font-size: 1.1rem;
        }
        
        .btn-sm {
            padding: 5px 10px;
            font-size: 0.85rem;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-control {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            font-family: 'Tajawal', sans-serif;
        }
        
        textarea.form-control {
            resize: vertical;
        }
        
        /* Ù†Ø§ÙØ°Ø© Ù…Ù†Ø¨Ø«Ù‚Ø© */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal.show {
            display: flex;
        }
        
        .modal-content {
            background: white;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        .modal-content.large {
            max-width: 800px;
        }
        
        .modal-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-header h3 {
            margin: 0;
            color: var(--secondary-color);
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }
        
        .modal-close:hover {
            background: #f8f9fa;
        }
        
        .modal-body {
            padding: 20px;
        }
        
        .modal-footer {
            padding: 20px;
            border-top: 1px solid var(--border-color);
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }
        
        /* Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± */
        .test-card {
            background: var(--light-color);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid var(--primary-color);
            transition: all 0.3s ease;
        }
        
        .test-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .test-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .test-title {
            font-weight: bold;
            color: var(--secondary-color);
            flex: 1;
        }
        
        .test-meta {
            display: flex;
            gap: 15px;
            color: #666;
            font-size: 0.9rem;
        }
        
        .test-actions {
            display: flex;
            gap: 5px;
            margin-top: 10px;
            flex-wrap: wrap;
        }
        
        /* Ù‚Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø© */
        .subject-section {
            margin-bottom: 30px;
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: var(--shadow);
        }
        
        .subject-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--light-color);
        }
        
        .subject-header h3 {
            margin: 0;
            color: var(--secondary-color);
        }
        
        .subject-icon {
            font-size: 1.5rem;
        }
        
        /* Ø­Ø§Ù„Ø© ÙØ§Ø±ØºØ© */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #666;
        }
        
        .empty-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            opacity: 0.5;
        }
        
        /* Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª */
        .tests-actions {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            justify-content: center;
        }
        
        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ø³ØªÙŠØ±Ø§Ø¯/ØªØµØ¯ÙŠØ± */
        .import-export-section {
            background: var(--light-color);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        
        .file-upload-box {
            border: 2px dashed var(--border-color);
            border-radius: 8px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 15px 0;
        }
        
        .file-upload-box:hover {
            border-color: var(--primary-color);
            background: white;
        }
        
        .upload-icon {
            font-size: 3rem;
            margin-bottom: 10px;
            opacity: 0.5;
        }
        
        /* Ø±Ø¨Ø· Ø§Ù„Ø£Ù‡Ø¯Ø§Ù */
        .objectives-linking {
            max-height: 300px;
            overflow-y: auto;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            margin: 15px 0;
        }
        
        .objective-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px;
            margin: 5px 0;
            background: white;
            border-radius: 4px;
            border: 1px solid var(--border-color);
        }
        
        .linking-progress {
            margin-bottom: 20px;
        }
        
        /* Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± */
        .questions-preview {
            margin-top: 20px;
        }
        
        .question-preview {
            background: var(--light-color);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }
        
        /* Ø®ÙŠØ§Ø±Ø§Øª Ù…ØªØ¹Ø¯Ø¯Ø© */
        .choice-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 5px 0;
            padding: 8px;
            background: white;
            border-radius: 4px;
            border: 1px solid var(--border-color);
        }
        
        .choice-item.correct {
            background: #d4edda;
            border-color: #c3e6cb;
        }
        
        @media (max-width: 768px) {
            .sidebar {
                width: 200px;
            }
            
            .main-content-dashboard {
                margin-right: 200px;
            }
            
            .tests-actions {
                flex-direction: column;
            }
            
            .test-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .test-meta {
                flex-direction: column;
                gap: 5px;
            }
        }
        
        @media (max-width: 576px) {
            .sidebar {
                transform: translateX(100%);
                width: 250px;
            }
            
            .sidebar.active {
                transform: translateX(0);
            }
            
            .main-content-dashboard {
                margin-right: 0;
            }
            
            .dashboard-content {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <!-- Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <h2>Ù…ÙŠØ³Ø± Ø§Ù„ØªØ¹Ù„Ù…</h2>
                </div>
            </div>
            <ul class="sidebar-menu">
                <li><a href="dashboard.html">ğŸ  Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</a></li>
                <li><a href="diagnostic-tests.html" class="active">ğŸ“Š Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„ØªØ´Ø®ÙŠØµÙŠØ©</a></li>
                <li><a href="students.html">ğŸ‘¨â€ğŸ“ Ø§Ù„Ø·Ù„Ø§Ø¨</a></li>
                <li><a href="library.html">ğŸ“š Ù…ÙƒØªØ¨Ø© Ø§Ù„Ù…Ø­ØªÙˆÙ‰</a></li>
                <li><a href="committee.html">ğŸ‘¥ Ø§Ù„Ù„Ø¬Ù†Ø©</a></li>
                <li><a href="#" onclick="logout()">ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</a></li>
            </ul>
        </div>

        <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
        <div class="main-content-dashboard">
            <header class="dashboard-header">
                <div class="user-info">
                    <div class="user-welcome">
                        <div class="welcome-text">Ù…Ø±Ø­Ø¨Ø§Ù‹</div>
                        <div class="user-name" id="userName"></div>
                    </div>
                    <div class="user-avatar" id="userAvatar"></div>
                </div>
            </header>

            <main class="dashboard-content">
                <div class="content-header">
                    <h1>ğŸ“Š Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„ØªØ´Ø®ÙŠØµÙŠØ©</h1>
                </div>

                <div class="diagnostic-tests-container">
                    <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø³Ø±ÙŠØ¹Ø© -->
                    <div class="tests-actions">
                        <button class="btn btn-success btn-lg" onclick="showCreateTestModal()">
                            ğŸ“ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ø®ØªØ¨Ø§Ø± ØªØ´Ø®ÙŠØµÙŠ Ø¬Ø¯ÙŠØ¯
                        </button>
                        <button class="btn btn-primary btn-lg" onclick="showImportTestModal()">
                            ğŸ“‚ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ø®ØªØ¨Ø§Ø±
                        </button>
                    </div>

                    <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ù…Ø§Ø¯Ø© -->
                    <div class="tests-list">
                        <!-- Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ù…Ø§Ø¯Ø© Ù„ØºØªÙŠ -->
                        <div class="subject-section">
                            <div class="subject-header">
                                <span class="subject-icon">ğŸ“š</span>
                                <h3>Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ù…Ø§Ø¯Ø© Ù„ØºØªÙŠ</h3>
                            </div>
                            <div id="arabicTestsList" class="subject-tests">
                                <!-- Ø³ÙŠØªÙ… ØªØ¹Ø¨Ø¦ØªÙ‡ Ø¨Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±ÙŠØ¨Øª -->
                            </div>
                        </div>

                        <!-- Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ù…Ø§Ø¯Ø© Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª -->
                        <div class="subject-section">
                            <div class="subject-header">
                                <span class="subject-icon">ğŸ”¢</span>
                                <h3>Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ù…Ø§Ø¯Ø© Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª</h3>
                            </div>
                            <div id="mathTestsList" class="subject-tests">
                                <!-- Ø³ÙŠØªÙ… ØªØ¹Ø¨Ø¦ØªÙ‡ Ø¨Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±ÙŠØ¨Øª -->
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ø¥Ù†Ø´Ø§Ø¡ Ø§Ø®ØªØ¨Ø§Ø± Ø¬Ø¯ÙŠØ¯ -->
    <div id="createTestModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Ø¥Ù†Ø´Ø§Ø¡ Ø§Ø®ØªØ¨Ø§Ø± ØªØ´Ø®ÙŠØµÙŠ Ø¬Ø¯ÙŠØ¯</h3>
                <button class="modal-close" onclick="closeCreateTestModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="createTestForm">
                    <div class="form-group">
                        <label for="testTitle">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± *</label>
                        <input type="text" id="testTitle" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="testSubject">Ø§Ù„Ù…Ø§Ø¯Ø© *</label>
                        <select id="testSubject" class="form-control" required>
                            <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø§Ø¯Ø©</option>
                            <option value="Ù„ØºØªÙŠ">Ù„ØºØªÙŠ</option>
                            <option value="Ø±ÙŠØ§Ø¶ÙŠØ§Øª">Ø±ÙŠØ§Ø¶ÙŠØ§Øª</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="testDescription">ÙˆØµÙ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                        <textarea id="testDescription" class="form-control" rows="3"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeCreateTestModal()">Ø¥Ù„ØºØ§Ø¡</button>
                <button class="btn btn-success" onclick="createNewTest()">Ø¥Ù†Ø´Ø§Ø¡</button>
            </div>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ø®ØªØ¨Ø§Ø± -->
    <div id="importTestModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ø®ØªØ¨Ø§Ø± ØªØ´Ø®ÙŠØµÙŠ</h3>
                <button class="modal-close" onclick="closeImportTestModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="import-export-section">
                    <div class="file-upload-box" onclick="document.getElementById('importFile').click()">
                        <div class="upload-icon">ğŸ“</div>
                        <p>Ø§Ù†Ù‚Ø± Ù„Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø£Ùˆ Ø§Ø³Ø­Ø¨ Ø§Ù„Ù…Ù„Ù Ù‡Ù†Ø§</p>
                        <input type="file" id="importFile" style="display: none;" accept=".json">
                    </div>
                    <p><small>Ù…Ù„Ø§Ø­Ø¸Ø©: Ø¨Ø¹Ø¯ Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯ ÙŠØ¬Ø¨ Ø±Ø¨Ø· Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø¨Ø§Ù„Ø£Ù‡Ø¯Ø§Ù Ø§Ù„Ù‚ØµÙŠØ±Ø©</small></p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeImportTestModal()">Ø¥Ù„ØºØ§Ø¡</button>
                <button class="btn btn-success" onclick="importTest()">Ø§Ø³ØªÙŠØ±Ø§Ø¯</button>
            </div>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± -->
    <div id="viewTestModal" class="modal">
        <div class="modal-content large">
            <div class="modal-header">
                <h3 id="viewTestTitle">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</h3>
                <button class="modal-close" onclick="closeViewTestModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="test-details">
                    <p><strong>Ø§Ù„Ù…Ø§Ø¯Ø©:</strong> <span id="viewTestSubject"></span></p>
                    <p><strong>Ø§Ù„ÙˆØµÙ:</strong> <span id="viewTestDescription"></span></p>
                    <p><strong>Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©:</strong> <span id="viewTestQuestionsCount"></span></p>
                    <p><strong>Ù…Ø­Ùƒ Ø§Ù„Ø§Ø¬ØªÙŠØ§Ø²:</strong> <span id="viewTestPassCriteria"></span></p>
                    <p><strong>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡:</strong> <span id="viewTestCreatedAt"></span></p>
                </div>
                <div class="questions-preview">
                    <h4>Ø§Ù„Ø£Ø³Ø¦Ù„Ø©:</h4>
                    <div id="viewTestQuestions"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeViewTestModal()">Ø¥ØºÙ„Ø§Ù‚</button>
            </div>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ø±Ø¨Ø· Ø§Ù„Ø£Ù‡Ø¯Ø§Ù -->
    <div id="linkObjectivesModal" class="modal">
        <div class="modal-content large">
            <div class="modal-header">
                <h3>Ø±Ø¨Ø· Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø¨Ø§Ù„Ø£Ù‡Ø¯Ø§Ù Ø§Ù„Ù‚ØµÙŠØ±Ø©</h3>
                <button class="modal-close" onclick="closeLinkObjectivesModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="linking-progress">
                    <h4 id="linkingProgress"></h4>
                    <div class="current-question">
                        <h5>Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ø­Ø§Ù„ÙŠ:</h5>
                        <p id="linkingQuestionText"></p>
                    </div>
                    <div class="objectives-linking">
                        <h5>Ø§Ø®ØªØ± Ù‡Ø¯Ù Ù‚ØµÙŠØ± Ù„Ù‡Ø°Ø§ Ø§Ù„Ø³Ø¤Ø§Ù„:</h5>
                        <div id="objectivesList"></div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeLinkObjectivesModal()">Ø¥Ù„ØºØ§Ø¡</button>
                <button class="btn btn-success" onclick="nextQuestionForLinking()">Ø§Ù„ØªØ§Ù„ÙŠ</button>
            </div>
        </div>
    </div>

    <script>
        // Ø¯Ø§Ù„Ø© Ø¥Ø´Ø¹Ø§Ø± Ø¨Ø³ÙŠØ·Ø©
        function showAuthNotification(message, type = 'info') {
            alert(type.toUpperCase() + ': ' + message);
        }
        
        // Ø¯Ø§Ù„Ø© ØªÙˆÙ„ÙŠØ¯ Ù…Ø¹Ø±Ù
        function generateId() {
            return Math.floor(Math.random() * 1000000) + 1;
        }
        
        // Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© (Ù…Ø¨Ø³Ø·Ø©)
        function checkAuth() {
            return {
                id: 1,
                name: 'Ø§Ù„Ù…Ø¹Ù„Ù… Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ',
                role: 'teacher'
            };
        }
        
        // Ø¯Ø§Ù„Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
        function logout() {
            if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ØŸ')) {
                window.location.href = '../../index.html';
            }
        }
        
        // Ø¯Ø§Ù„Ø© ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØªØ§Ø±ÙŠØ®
        function formatDate(dateString) {
            if (!dateString) return 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
            const date = new Date(dateString);
            return date.toLocaleDateString('ar-SA') + ' ' + date.toLocaleTimeString('ar-SA');
        }
        
        // Ø¯Ø§Ù„Ø© ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…Ø®ØªØµØ±
        function formatDateShort(dateString) {
            if (!dateString) return 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
            const date = new Date(dateString);
            return date.toLocaleDateString('ar-SA');
        }
        
        // Ø¯ÙˆØ§Ù„ Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ
        function getDiagnosticTests() {
            return JSON.parse(localStorage.getItem('diagnosticTests') || '[]');
        }
        
        function getDiagnosticTestById(id) {
            const tests = getDiagnosticTests();
            return tests.find(test => test.id === id);
        }
        
        function saveDiagnosticTest(test) {
            const tests = getDiagnosticTests();
            const index = tests.findIndex(t => t.id === test.id);
            
            if (index >= 0) {
                tests[index] = test;
            } else {
                tests.push(test);
            }
            
            localStorage.setItem('diagnosticTests', JSON.stringify(tests));
            return test;
        }
        
        // Ø¯Ø§Ù„Ø© Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª
        function loadDiagnosticTests() {
            const tests = getDiagnosticTests();
            const arabicTests = tests.filter(test => test.subject === 'Ù„ØºØªÙŠ');
            const mathTests = tests.filter(test => test.subject === 'Ø±ÙŠØ§Ø¶ÙŠØ§Øª');
            
            displayTestsBySubject('arabicTestsList', arabicTests, 'ğŸ“š', 'Ù„ØºØªÙŠ');
            displayTestsBySubject('mathTestsList', mathTests, 'ğŸ”¢', 'Ø±ÙŠØ§Ø¶ÙŠØ§Øª');
        }
        
        function displayTestsBySubject(containerId, tests, icon, subjectName) {
            const container = document.getElementById(containerId);
            
            if (!container) return;
            
            if (tests.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">${icon}</div>
                        <h3>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ù„Ù…Ø§Ø¯Ø© ${subjectName}</h3>
                        <p>Ù‚Ù… Ø¨Ø¥Ù†Ø´Ø§Ø¡ Ø£ÙˆÙ„ Ø§Ø®ØªØ¨Ø§Ø± ØªØ´Ø®ÙŠØµÙŠ</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = tests.map(test => {
                const objectivesStatus = test.objectivesLinked ? 
                    '<span class="objectives-status status-linked">ØªÙ… Ø§Ù„Ø±Ø¨Ø·</span>' :
                    '<span class="objectives-status status-not-linked">Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø±Ø¨Ø·</span>';
                
                return `
                    <div class="test-card">
                        <div class="test-header">
                            <div class="test-title">${test.title}</div>
                            <div class="test-meta">
                                <span class="test-subject-badge ${test.subject === 'Ù„ØºØªÙŠ' ? 'subject-arabic' : 'subject-math'}">
                                    ${test.subject}
                                </span>
                                ${objectivesStatus}
                                <span>${formatDateShort(test.createdAt)}</span>
                            </div>
                        </div>
                        ${test.description ? `<p>${test.description}</p>` : ''}
                        <div class="test-actions">
                            <button class="btn btn-sm btn-primary" onclick="viewTest(${test.id})">
                                Ø¹Ø±Ø¶
                            </button>
                            <button class="btn btn-sm btn-warning" onclick="editTest(${test.id})">
                                ØªØ¹Ø¯ÙŠÙ„
                            </button>
                            <button class="btn btn-sm btn-info" onclick="linkObjectives(${test.id})">
                                Ø±Ø¨Ø· Ø§Ù„Ø£Ù‡Ø¯Ø§Ù
                            </button>
                            <button class="btn btn-sm btn-secondary" onclick="exportTest(${test.id})">
                                ØªØµØ¯ÙŠØ±
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="deleteTest(${test.id})">
                                Ø­Ø°Ù
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        // Ø¯ÙˆØ§Ù„ Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©
        function showCreateTestModal() {
            console.log('ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø¥Ù†Ø´Ø§Ø¡ Ø§Ø®ØªØ¨Ø§Ø±');
            document.getElementById('createTestModal').classList.add('show');
        }
        
        function closeCreateTestModal() {
            document.getElementById('createTestModal').classList.remove('show');
            document.getElementById('createTestForm').reset();
        }
        
        function showImportTestModal() {
            document.getElementById('importTestModal').classList.add('show');
        }
        
        function closeImportTestModal() {
            document.getElementById('importTestModal').classList.remove('show');
        }
        
        function closeViewTestModal() {
            document.getElementById('viewTestModal').classList.remove('show');
        }
        
        function closeLinkObjectivesModal() {
            document.getElementById('linkObjectivesModal').classList.remove('show');
        }
        
        // Ø¯Ø§Ù„Ø© Ø¥Ù†Ø´Ø§Ø¡ Ø§Ø®ØªØ¨Ø§Ø± Ø¬Ø¯ÙŠØ¯
        function createNewTest() {
            const title = document.getElementById('testTitle').value.trim();
            const subject = document.getElementById('testSubject').value;
            const description = document.getElementById('testDescription').value.trim();
            
            console.log('Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù†Ù…ÙˆØ°Ø¬:', { title, subject, description });
            
            if (!title || !subject) {
                showAuthNotification('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± ÙˆØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ø§Ø¯Ø©', 'error');
                return;
            }
            
            const test = {
                id: generateId(),
                title: title,
                subject: subject,
                description: description,
                questions: [],
                passCriteria: 70,
                objectivesLinked: false,
                createdAt: new Date().toISOString(),
                createdBy: checkAuth().id
            };
            
            console.log('Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø°ÙŠ Ø³ÙŠØªÙ… Ø­ÙØ¸Ù‡:', test);
            
            const savedTest = saveDiagnosticTest(test);
            console.log('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±:', savedTest);
            
            showAuthNotification('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø¨Ù†Ø¬Ø§Ø­', 'success');
            closeCreateTestModal();
            
            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ù…Ø±Ø© Ø£Ø®Ø±Ù‰
            loadDiagnosticTests();
            
            // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¥Ù„Ù‰ ØµÙØ­Ø© Ø§Ù„ØªØ­Ø±ÙŠØ± Ø¨Ø¹Ø¯ Ø«Ø§Ù†ÙŠØ©
            setTimeout(() => {
                editTest(savedTest.id);
            }, 1000);
        }
        
        // Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
        function editTest(testId) {
            console.log('ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±:', testId);
            window.location.href = `test-editor.html?id=${testId}`;
        }
        
        // Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
        function viewTest(testId) {
            const test = getDiagnosticTestById(testId);
            if (!test) {
                showAuthNotification('Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'error');
                return;
            }
            
            document.getElementById('viewTestTitle').textContent = test.title;
            document.getElementById('viewTestSubject').textContent = test.subject;
            document.getElementById('viewTestDescription').textContent = test.description || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ';
            document.getElementById('viewTestQuestionsCount').textContent = test.questions?.length || 0;
            document.getElementById('viewTestPassCriteria').textContent = test.passCriteria + '%';
            document.getElementById('viewTestCreatedAt').textContent = formatDate(test.createdAt);
            
            const questionsList = document.getElementById('viewTestQuestions');
            if (test.questions && test.questions.length > 0) {
                questionsList.innerHTML = test.questions.map((q, index) => `
                    <div class="question-preview">
                        <div class="question-header">
                            <h5>Ø§Ù„Ø³Ø¤Ø§Ù„ ${index + 1}</h5>
                        </div>
                        <div class="question-content">
                            <p>${q.text}</p>
                        </div>
                    </div>
                `).join('');
            } else {
                questionsList.innerHTML = '<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø³Ø¦Ù„Ø© ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</p>';
            }
            
            document.getElementById('viewTestModal').classList.add('show');
        }
        
        // Ø¯Ø§Ù„Ø© Ø±Ø¨Ø· Ø§Ù„Ø£Ù‡Ø¯Ø§Ù (Ù…Ø¨Ø³Ø·Ø©)
        function linkObjectives(testId) {
            const test = getDiagnosticTestById(testId);
            if (!test || !test.questions || test.questions.length === 0) {
                showAuthNotification('ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ­ØªÙˆÙŠ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø¹Ù„Ù‰ Ø£Ø³Ø¦Ù„Ø© Ø£ÙˆÙ„Ø§Ù‹', 'error');
                return;
            }
            
            showAuthNotification('ÙŠØ¬Ø¨ Ø£Ù† ØªØ°Ù‡Ø¨ Ù„ØµÙØ­Ø© Ø§Ù„ØªØ­Ø±ÙŠØ± Ù„Ø±Ø¨Ø· Ø§Ù„Ø£Ù‡Ø¯Ø§Ù', 'info');
            editTest(testId);
        }
        
        // Ø¯Ø§Ù„Ø© Ø§Ù„ØªØµØ¯ÙŠØ± (Ù…Ø¨Ø³Ø·Ø©)
        function exportTest(testId) {
            const test = getDiagnosticTestById(testId);
            if (!test) return;
            
            // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø£Ù‡Ø¯Ø§Ù Ø§Ù„Ù…Ø±Ø¨ÙˆØ·Ø© Ø¹Ù†Ø¯ Ø§Ù„ØªØµØ¯ÙŠØ±
            const exportData = {
                ...test,
                objectivesLinked: false,
                linkedObjectives: {}
            };
            
            const blob = new Blob([JSON.stringify(exportData, null, 2)], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `test-${test.id}-${test.title}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showAuthNotification('ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø¨Ù†Ø¬Ø§Ø­', 'success');
        }
        
        // Ø¯Ø§Ù„Ø© Ø§Ù„Ø­Ø°Ù
        function deleteTest(testId) {
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±ØŸ')) {
                return;
            }
            
            const tests = getDiagnosticTests();
            const updatedTests = tests.filter(test => test.id !== testId);
            
            localStorage.setItem('diagnosticTests', JSON.stringify(updatedTests));
            
            showAuthNotification('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø¨Ù†Ø¬Ø§Ø­', 'success');
            loadDiagnosticTests();
        }
        
        // Ø¯Ø§Ù„Ø© Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯
        async function importTest() {
            const fileInput = document.getElementById('importFile');
            const file = fileInput.files[0];
            
            if (!file) {
                showAuthNotification('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Ù„Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯', 'error');
                return;
            }
            
            try {
                const text = await readFileAsText(file);
                const importedTest = JSON.parse(text);
                
                // ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                importedTest.id = generateId();
                importedTest.createdAt = new Date().toISOString();
                importedTest.createdBy = checkAuth().id;
                importedTest.objectivesLinked = false;
                importedTest.linkedObjectives = {};
                
                saveDiagnosticTest(importedTest);
                
                showAuthNotification('ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø¨Ù†Ø¬Ø§Ø­', 'success');
                closeImportTestModal();
                loadDiagnosticTests();
                
                setTimeout(() => {
                    showAuthNotification('ÙŠØ±Ø¬Ù‰ Ø±Ø¨Ø· Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø¨Ø§Ù„Ø£Ù‡Ø¯Ø§Ù Ø§Ù„Ù‚ØµÙŠØ±Ø©', 'warning');
                }, 1000);
                
            } catch (error) {
                showAuthNotification('Ø®Ø·Ø£ ÙÙŠ ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ù…Ù„Ù', 'error');
                console.error(error);
            }
        }
        
        function readFileAsText(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = e => resolve(e.target.result);
                reader.onerror = e => reject(e);
                reader.readAsText(file);
            });
        }
        
        // Ø¯Ø§Ù„Ø© Ø§Ù„Ø±Ø¨Ø·
        function nextQuestionForLinking() {
            showAuthNotification('Ù‡Ø°Ù‡ ÙˆØ¸ÙŠÙØ© Ø³ÙŠØªÙ… ØªÙ†ÙÙŠØ°Ù‡Ø§ ÙÙŠ ØµÙØ­Ø© Ø§Ù„ØªØ­Ø±ÙŠØ±', 'info');
        }
        
        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙØ­Ø©
        document.addEventListener('DOMContentLoaded', function() {
            const user = checkAuth();
            if (!user || user.role !== 'teacher') {
                window.location.href = '../../index.html';
                return;
            }
            
            document.getElementById('userName').textContent = user.name;
            document.getElementById('userAvatar').textContent = user.name.charAt(0);
            
            loadDiagnosticTests();
            
            console.log('âœ… ØµÙØ­Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„ØªØ´Ø®ÙŠØµÙŠØ© Ø¬Ø§Ù‡Ø²Ø©');
        });
    </script>
</body>
</html>
