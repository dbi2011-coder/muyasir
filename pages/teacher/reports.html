<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ÙˆØ§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª - Ù…ÙŠØ³Ø± Ø§Ù„ØªØ¹Ù„Ù…</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
    
    <style>
        /* =========================================
           ğŸ”¥ Ø§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ù…Ø¯Ù…Ø¬ (CSS) ğŸ”¥
           ========================================= */
        :root { --primary: #2c3e50; --secondary: #34495e; --accent: #007bff; --light: #ecf0f1; --success: #27ae60; --danger: #c0392b; }
        
        body { font-family: 'Tajawal', sans-serif; background-color: #f4f6f9; margin: 0; display: flex; height: 100vh; overflow: hidden; }
        
        /* Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ */
        .sidebar { width: 260px; background: var(--primary); color: white; display: flex; flex-direction: column; box-shadow: 2px 0 5px rgba(0,0,0,0.1); }
        .sidebar-header { padding: 20px; text-align: center; border-bottom: 1px solid rgba(255,255,255,0.1); background: var(--secondary); }
        .logo h2 { margin: 10px 0 0; font-size: 1.4rem; }
        .logo i { font-size: 2.5rem; color: var(--accent); } /* Ø´Ø¹Ø§Ø± Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† ØµÙˆØ±Ø© */
        
        .sidebar-menu { list-style: none; padding: 0; margin: 20px 0; flex: 1; }
        .sidebar-menu li a { display: flex; align-items: center; padding: 15px 25px; color: #bdc3c7; text-decoration: none; transition: 0.3s; font-size: 1rem; }
        .sidebar-menu li a:hover, .sidebar-menu li a.active { background: rgba(0,0,0,0.2); color: white; border-right: 4px solid var(--accent); }
        .menu-icon { margin-left: 10px; width: 25px; text-align: center; }

        /* Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ */
        .main-content-dashboard { flex: 1; display: flex; flex-direction: column; overflow-y: auto; }
        .dashboard-header { background: white; padding: 15px 30px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .user-welcome { font-weight: bold; color: var(--primary); }
        
        .dashboard-content { padding: 30px; }

        /* Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± */
        .reports-controls {
            background: white; padding: 25px; border-radius: 12px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 30px;
            display: grid; grid-template-columns: 1fr 1.5fr auto; gap: 20px; align-items: end;
            border: 1px solid #e9ecef;
        }
        
        .control-group label { display: block; font-weight: bold; margin-bottom: 8px; color: var(--secondary); font-size: 0.9rem; }
        .control-group select { 
            width: 100%; padding: 10px; border: 2px solid #dfe6e9; border-radius: 8px; 
            font-family: 'Tajawal'; font-size: 0.95rem; outline: none; transition: 0.3s;
        }
        .control-group select:focus { border-color: var(--accent); }

        /* Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø§Ø¨ */
        .student-selector {
            max-height: 120px; overflow-y: auto; background: #f8f9fa; 
            padding: 10px; border: 2px solid #dfe6e9; border-radius: 8px;
        }
        .student-checkbox { 
            display: flex; align-items: center; gap: 10px; margin-bottom: 5px; 
            padding: 6px; background: white; border-radius: 5px; cursor: pointer; transition: 0.2s; border: 1px solid #eee;
        }
        .student-checkbox:hover { background: #e3f2fd; border-color: var(--accent); }
        .student-checkbox label { cursor: pointer; margin: 0; width: 100%; }

        /* Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
        .btn { padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer; font-family: 'Tajawal'; font-weight: bold; transition: 0.2s; display: inline-flex; align-items: center; gap: 8px; font-size: 0.95rem; }
        .btn-primary { background: var(--accent); color: white; }
        .btn-primary:hover { background: #0056b3; transform: translateY(-2px); box-shadow: 0 4px 10px rgba(0,123,255,0.3); }
        .btn-success { background: var(--success); color: white; }
        .btn-success:hover { background: #219150; transform: translateY(-2px); box-shadow: 0 4px 10px rgba(39,174,96,0.3); }

        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© (A4) */
        .report-preview-bg {
            background: #525659; padding: 40px; border-radius: 12px;
            display: flex; justify-content: center; overflow-x: auto; min-height: 500px;
        }
        
        .report-paper {
            background: white; width: 210mm; min-height: 297mm; padding: 20mm;
            box-shadow: 0 0 25px rgba(0,0,0,0.5); position: relative;
            color: black;
        }

        /* Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ Ø¯Ø§Ø®Ù„ Ø§Ù„ØªÙ‚Ø±ÙŠØ± */
        .report-table { width: 100%; border-collapse: collapse; margin-top: 30px; font-size: 14px; }
        .report-table th, .report-table td { border: 1px solid #000; padding: 10px; text-align: center; vertical-align: middle; }
        .report-table th { background-color: #f0f0f0; font-weight: bold; color: #000; }
        
        .report-header { text-align: center; margin-bottom: 30px; border-bottom: 2px double #000; padding-bottom: 20px; }
        .report-header h1 { margin: 0; font-size: 22px; color: #000; }
        .report-header h2 { margin: 5px 0; font-size: 16px; color: #333; font-weight: normal; }
        .report-meta { display: flex; justify-content: space-between; margin-top: 25px; font-size: 14px; color: #000; }

        .status-good { color: #155724; background-color: #d4edda; font-weight: bold; }
        .status-bad { color: #721c24; background-color: #f8d7da; font-weight: bold; }

        /* Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© */
        @media print {
            body * { visibility: hidden; }
            #reportPaper, #reportPaper * { visibility: visible; }
            #reportPaper { position: absolute; left: 0; top: 0; width: 100%; margin: 0; padding: 0; box-shadow: none; }
        }
    </style>
</head>
<body>

    <aside class="sidebar">
        <div class="sidebar-header">
            <div class="logo">
                <i class="fas fa-book-open"></i> <h2>Ù…ÙŠØ³Ø± Ø§Ù„ØªØ¹Ù„Ù…</h2>
            </div>
        </div>
        <ul class="sidebar-menu">
            <li><a href="dashboard.html"><span class="menu-icon"><i class="fas fa-home"></i></span>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a></li>
            <li><a href="reports.html" class="active"><span class="menu-icon"><i class="fas fa-chart-pie"></i></span>Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</a></li>
            <li><a href="#" onclick="alert('Ø®Ø±ÙˆØ¬')"><span class="menu-icon"><i class="fas fa-sign-out-alt"></i></span>Ø®Ø±ÙˆØ¬</a></li>
        </ul>
    </aside>

    <main class="main-content-dashboard">
        <header class="dashboard-header">
            <div class="user-welcome">
                <span>Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨ÙƒØŒ </span>
                <span id="currentUserName" style="color:var(--accent);">Ø§Ù„Ù…Ø¹Ù„Ù…</span>
            </div>
            <div>
                <button class="btn btn-primary" style="padding: 5px 15px; font-size:0.8rem;">ğŸ””</button>
            </div>
        </header>

        <div class="dashboard-content">
            <div class="reports-controls">
                <div class="control-group">
                    <label><i class="fas fa-file-alt"></i> Ù†ÙˆØ¹ Ø§Ù„ØªÙ‚Ø±ÙŠØ±:</label>
                    <select id="reportTypeSelector">
                        <option value="">-- Ø§Ø®ØªØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ --</option>
                        <option value="attendance">ğŸ“‹ ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØºÙŠØ§Ø¨</option>
                        <option value="progress">ğŸ“ˆ ØªÙ‚Ø±ÙŠØ± Ù†Ø³Ø¨ Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²</option>
                        <option value="assignments">ğŸ“ ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª</option>
                        <option value="iep">ğŸ—‚ï¸ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø®Ø·Ø· Ø§Ù„ØªØ±Ø¨ÙˆÙŠØ© (IEP)</option>
                        <option value="diagnostic">ğŸ” ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„ØªØ´Ø®ÙŠØµÙŠØ©</option>
                        <option value="schedule">ğŸ“… ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ</option>
                        <option value="balance" id="optSessionBalance">âš–ï¸ ØªÙ‚Ø±ÙŠØ± Ø±ØµÙŠØ¯ Ø§Ù„Ø­ØµØµ (Ø®Ø§Øµ)</option> 
                        <option value="committee">ğŸ¤ ØªÙ‚Ø±ÙŠØ± Ù„Ø¬Ù†Ø© ØµØ¹ÙˆØ¨Ø§Øª Ø§Ù„ØªØ¹Ù„Ù…</option>
                        <option value="certificate">ğŸ† Ø´Ù‡Ø§Ø¯Ø© Ø¥Ù†Ø¬Ø§Ø² Ù…Ù‡Ø§Ø±Ø©</option>
                    </select>
                </div>

                <div class="control-group" id="studentSelectorGroup">
                    <label><i class="fas fa-users"></i> ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø·Ù„Ø§Ø¨:</label>
                    <div class="student-selector" id="studentCheckboxes">
                        </div>
                    <div style="margin-top:5px;">
                        <label style="cursor:pointer; font-size:0.9rem;">
                            <input type="checkbox" onchange="selectAllStudents(this)"> ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙƒÙ„
                        </label>
                    </div>
                </div>

                <div>
                    <button class="btn btn-primary" onclick="generateReport()">
                        <i class="fas fa-search"></i> Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø±ÙŠØ±
                    </button>
                </div>
            </div>

            <div id="reportActions" style="display:none; margin-bottom:15px;">
                <button class="btn btn-success" onclick="downloadPDF()">
                    <i class="fas fa-file-pdf"></i> Ø­ÙØ¸ ÙƒÙ…Ù„Ù PDF / Ø·Ø¨Ø§Ø¹Ø©
                </button>
            </div>

            <div class="report-preview-bg">
                <div id="reportPaper" class="report-paper">
                    <div style="text-align:center; color:#999; margin-top:50%;">
                        <i class="fas fa-print fa-3x mb-3"></i>
                        <p>Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„ØªÙ‚Ø±ÙŠØ± ÙˆØ§Ù„Ø·Ù„Ø§Ø¨ Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù‡Ù†Ø§</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // =========================================
        // ğŸ”¥ Ø§Ù„Ø¨Ø±Ù…Ø¬Ø© Ø§Ù„Ù…Ø¯Ù…Ø¬Ø© (JS) ğŸ”¥
        // =========================================

        document.addEventListener('DOMContentLoaded', function() {
            initMockData(); // Ø¥Ù†Ø´Ø§Ø¡ Ø¨ÙŠØ§Ù†Ø§Øª ÙˆÙ‡Ù…ÙŠØ© Ù„Ù„ØªØ¬Ø±Ø¨Ø© ÙÙˆØ±Ø§Ù‹
            checkPermissions();
            loadStudentList();
        });

        // 1. ØªØ¬Ù‡ÙŠØ² Ø¨ÙŠØ§Ù†Ø§Øª ÙˆÙ‡Ù…ÙŠØ© (Ù„Ø­Ù„ Ù…Ø´ÙƒÙ„Ø© Ø§Ù„ØµÙØ­Ø© Ø§Ù„ÙØ§Ø±ØºØ©)
        function initMockData() {
            if (!sessionStorage.getItem('currentUser')) {
                const teacher = { id: 1, name: "Ø£. Ù…Ø­Ù…Ø¯ Ø§Ù„Ø¹ØªÙŠØ¨ÙŠ", role: "teacher" };
                sessionStorage.setItem('currentUser', JSON.stringify({ user: teacher }));
            }
            if (!localStorage.getItem('students')) {
                const mockStudents = [
                    { id: 101, name: "Ù†Ø§ÙŠÙ Ù…Ø­Ù…Ø¯", grade: "Ø§Ù„Ø±Ø§Ø¨Ø¹", diagnosis: "Ø¹Ø³Ø± Ù‚Ø±Ø§Ø¡Ø©" },
                    { id: 102, name: "Ø³Ø¹ÙˆØ¯ ÙÙŠØµÙ„", grade: "Ø§Ù„Ø®Ø§Ù…Ø³", diagnosis: "ØªØ´ØªØª Ø§Ù†ØªØ¨Ø§Ù‡" },
                    { id: 103, name: "Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø£Ø­Ù…Ø¯", grade: "Ø§Ù„Ø«Ø§Ù„Ø«", diagnosis: "Ø¹Ø³Ø± Ø­Ø³Ø§Ø¨" }
                ];
                localStorage.setItem('students', JSON.stringify(mockStudents));
            }
        }

        // 2. Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª
        function getCurrentUser() {
            return JSON.parse(sessionStorage.getItem('currentUser') || '{"user":{"role":"guest","name":"Ø²Ø§Ø¦Ø±"}}').user;
        }

        function checkPermissions() {
            const user = getCurrentUser();
            if(document.getElementById('currentUserName')) document.getElementById('currentUserName').innerText = user.name;
            
            const balanceOption = document.getElementById('optSessionBalance');
            if (user.role !== 'teacher' && user.role !== 'admin') {
                if(balanceOption) balanceOption.remove();
            }
        }

        // 3. Ø§Ù„Ù‚ÙˆØ§Ø¦Ù…
        function getStudentById(id) {
            const students = JSON.parse(localStorage.getItem('students') || '[]');
            return students.find(s => s.id == id) || {name: 'Ø·Ø§Ù„Ø¨'};
        }

        function loadStudentList() {
            const students = JSON.parse(localStorage.getItem('students') || '[]');
            const container = document.getElementById('studentCheckboxes');
            
            if (students.length === 0) {
                container.innerHTML = '<div style="color:red; padding:5px;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø§Ø¨</div>';
                return;
            }

            container.innerHTML = '';
            students.forEach(student => {
                const div = document.createElement('div');
                div.className = 'student-checkbox';
                div.innerHTML = `
                    <input type="checkbox" name="selectedStudent" value="${student.id}" id="st_${student.id}">
                    <label for="st_${student.id}">${student.name}</label>
                `;
                container.appendChild(div);
            });
        }

        function selectAllStudents(source) {
            const checkboxes = document.getElementsByName('selectedStudent');
            for(let i=0; i<checkboxes.length; i++) { checkboxes[i].checked = source.checked; }
        }

        // 4. ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ØªÙ‚Ø±ÙŠØ±
        function generateReport() {
            const type = document.getElementById('reportTypeSelector').value;
            const checkboxes = document.querySelectorAll('input[name="selectedStudent"]:checked');
            const selectedIds = Array.from(checkboxes).map(cb => cb.value);

            if (!type) { alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ù†ÙˆØ¹ Ø§Ù„ØªÙ‚Ø±ÙŠØ±"); return; }
            if (selectedIds.length === 0 && type !== 'schedule') {
                alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ø·Ø§Ù„Ø¨ ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„"); return;
            }

            const paper = document.getElementById('reportPaper');
            document.getElementById('reportActions').style.display = 'block';
            
            const headerHtml = `
                <div class="report-header">
                    <h1>Ø§Ù„Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©</h1>
                    <h2>ÙˆØ²Ø§Ø±Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ… - Ø¨Ø±Ù†Ø§Ù…Ø¬ ØµØ¹ÙˆØ¨Ø§Øª Ø§Ù„ØªØ¹Ù„Ù…</h2>
                    <br>
                    <h1 style="color:#2c3e50;">${getReportTitle(type)}</h1>
                    <div class="report-meta">
                        <span><strong>Ø§Ù„Ù…Ø¹Ù„Ù…:</strong> ${getCurrentUser().name}</span>
                        <span><strong>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©:</strong> ${new Date().toLocaleDateString('ar-SA')}</span>
                    </div>
                </div>
            `;

            let bodyHtml = '';
            switch(type) {
                case 'attendance': bodyHtml = generateAttendanceReport(selectedIds); break;
                case 'progress': bodyHtml = generateProgressReport(selectedIds); break;
                case 'assignments': bodyHtml = generateAssignmentsReport(selectedIds); break;
                case 'iep': bodyHtml = generateIEPReport(selectedIds); break;
                case 'diagnostic': bodyHtml = generateDiagnosticReport(selectedIds); break;
                case 'schedule': bodyHtml = generateScheduleReport(); break;
                case 'balance': bodyHtml = generateSessionBalanceReport(selectedIds); break;
                case 'committee': bodyHtml = generateCommitteeReport(selectedIds); break;
                case 'certificate': bodyHtml = generateCertificates(selectedIds); break;
            }

            paper.innerHTML = headerHtml + bodyHtml;
        }

        function getReportTitle(type) {
            const titles = {
                'attendance': 'ØªÙ‚Ø±ÙŠØ± Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„ØºÙŠØ§Ø¨ ÙˆØ§Ù„Ø­Ø¶ÙˆØ±',
                'progress': 'ØªÙ‚Ø±ÙŠØ± Ù†Ø³Ø¨ Ø§Ù„Ø¥Ù†Ø¬Ø§Ø² Ù„Ù„Ù…Ù‡Ø§Ø±Ø§Øª',
                'assignments': 'ØªÙ‚Ø±ÙŠØ± Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª',
                'iep': 'Ø§Ù„Ø®Ø·Ø© Ø§Ù„ØªØ±Ø¨ÙˆÙŠØ© Ø§Ù„ÙØ±Ø¯ÙŠØ© (IEP)',
                'diagnostic': 'Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„ØªØ´Ø®ÙŠØµÙŠØ©',
                'schedule': 'Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ Ù„ØºØ±ÙØ© Ø§Ù„Ù…ØµØ§Ø¯Ø±',
                'balance': 'Ø³Ø¬Ù„ Ø±ØµÙŠØ¯ Ø§Ù„Ø­ØµØµ (Ø¯Ø§Ø®Ù„ÙŠ)',
                'committee': 'Ù…Ø­Ø§Ø¶Ø± Ù„Ø¬Ù†Ø© ØµØ¹ÙˆØ¨Ø§Øª Ø§Ù„ØªØ¹Ù„Ù…',
                'certificate': 'Ø´Ù‡Ø§Ø¯Ø© Ø´ÙƒØ± ÙˆØªÙ‚Ø¯ÙŠØ±'
            };
            return titles[type] || 'ØªÙ‚Ø±ÙŠØ±';
        }

        // --- Ø¯ÙˆØ§Ù„ Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ (Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©) ---

        function generateAttendanceReport(ids) {
            let html = `<table class="report-table"><thead><tr><th>Ù…</th><th>Ø§Ù„Ø·Ø§Ù„Ø¨</th><th>Ø£ÙŠØ§Ù… Ø§Ù„ØºÙŠØ§Ø¨</th><th>Ø§Ù„ØªÙˆØ§Ø±ÙŠØ®</th><th>Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th></tr></thead><tbody>`;
            ids.forEach((id, index) => {
                const st = getStudentById(id);
                const days = Math.floor(Math.random() * 6);
                html += `<tr>
                    <td>${index + 1}</td>
                    <td>${st.name}</td>
                    <td class="${days > 3 ? 'status-bad' : ''}">${days} Ø£ÙŠØ§Ù…</td>
                    <td>${days > 0 ? '2023-10-01, 2023-10-15' : '-'}</td>
                    <td>${days > 3 ? 'ØªÙ†Ø¨ÙŠÙ‡: Ø§Ù„ØºÙŠØ§Ø¨ Ø£Ø«Ø± Ø¹Ù„Ù‰ Ø§Ù„ØªØ­Ø³Ù†' : 'Ù…Ù†ØªØ¸Ù…'}</td>
                </tr>`;
            });
            return html + `</tbody></table>`;
        }

        function generateProgressReport(ids) {
            let html = `<table class="report-table"><thead><tr><th>Ø§Ù„Ø·Ø§Ù„Ø¨</th><th>Ø§Ù„Ø¯Ø±Ø³ Ø§Ù„Ø­Ø§Ù„ÙŠ</th><th>Ù†Ø³Ø¨Ø© Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th></tr></thead><tbody>`;
            ids.forEach(id => {
                const st = getStudentById(id);
                const progress = Math.floor(Math.random() * 100);
                html += `<tr>
                    <td>${st.name}</td>
                    <td>Ø§Ù„ØªÙ…ÙŠÙŠØ² Ø¨ÙŠÙ† Ø§Ù„Ø­Ø±ÙˆÙ Ø§Ù„Ù…ØªØ´Ø§Ø¨Ù‡Ø©</td>
                    <td>
                        <div style="background:#eee; height:10px; width:100px; margin:auto; border-radius:5px;">
                            <div style="background:${progress>50?'#28a745':'#ffc107'}; height:100%; width:${progress}%; border-radius:5px;"></div>
                        </div>
                        ${progress}%
                    </td>
                    <td>${progress > 70 ? 'Ù…ØªÙ‚Ø¯Ù…' : 'ÙŠØ­ØªØ§Ø¬ Ø¯Ø¹Ù…'}</td>
                </tr>`;
            });
            return html + `</tbody></table>`;
        }

        function generateAssignmentsReport(ids) {
            let html = `<table class="report-table"><thead><tr><th>Ø§Ù„Ø·Ø§Ù„Ø¨</th><th>Ø§Ù„Ù…Ø³Ù†Ø¯Ø©</th><th>Ø§Ù„Ù…Ø­Ù„ÙˆÙ„Ø©</th><th>ØºÙŠØ± Ø§Ù„Ù…Ø­Ù„ÙˆÙ„Ø©</th><th>Ù†Ø³Ø¨Ø© Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…</th></tr></thead><tbody>`;
            ids.forEach(id => {
                const st = getStudentById(id);
                const total = 12;
                const solved = Math.floor(Math.random() * 13);
                const missed = total - solved;
                html += `<tr>
                    <td>${st.name}</td>
                    <td>${total}</td>
                    <td class="status-good">${solved}</td>
                    <td class="status-bad">${Math.max(0, missed)}</td>
                    <td>${Math.round((solved/total)*100)}%</td>
                </tr>`;
            });
            return html + `</tbody></table>`;
        }

        function generateIEPReport(ids) {
            let html = '';
            ids.forEach(id => {
                const st = getStudentById(id);
                html += `
                <div style="border:1px solid #333; padding:15px; margin-bottom:20px; text-align:right;">
                    <h3 style="border-bottom:1px solid #ccc; padding-bottom:5px; margin-top:0;">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨: ${st.name}</h3>
                    <p><strong>Ø§Ù„ØªØ´Ø®ÙŠØµ:</strong> ${st.diagnosis || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
                    <p><strong>Ù†Ù‚Ø§Ø· Ø§Ù„Ù‚ÙˆØ©:</strong> Ø§Ù„ØªØ¹Ø§ÙˆÙ†ØŒ Ø­Ø¨ Ø§Ù„Ø±Ø³Ù….</p>
                    <p><strong>Ù†Ù‚Ø§Ø· Ø§Ù„Ø§Ø­ØªÙŠØ§Ø¬:</strong> Ø§Ù„ØªÙ…ÙŠÙŠØ² Ø§Ù„Ø³Ù…Ø¹ÙŠØŒ Ø§Ù„Ø§Ù†ØªØ¨Ø§Ù‡.</p>
                    <table class="report-table" style="margin-top:10px;">
                        <thead><tr><th>Ø§Ù„Ù‡Ø¯Ù Ø§Ù„ØªØ¯Ø±ÙŠØ³ÙŠ</th><th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø¡</th><th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ØªÙˆÙ‚Ø¹ Ù„Ù„Ø¥Ù†Ø¬Ø§Ø²</th><th>Ø­Ø§Ù„Ø© Ø§Ù„Ù‡Ø¯Ù</th></tr></thead>
                        <tbody>
                            <tr><td>Ø£Ù† ÙŠÙ‚Ø±Ø£ Ø§Ù„Ø·Ø§Ù„Ø¨ ÙƒÙ„Ù…Ø§Øª Ø«Ù„Ø§Ø«ÙŠØ© Ø¨Ø­Ø±ÙƒØ© Ø§Ù„ÙØªØ­</td><td>2023-09-01</td><td>2023-09-30</td><td>âœ… ØªÙ… Ø§Ù„Ø¥ØªÙ‚Ø§Ù†</td></tr>
                            <tr><td>Ø£Ù† ÙŠÙ…ÙŠØ² Ø§Ù„Ø·Ø§Ù„Ø¨ Ø¨ÙŠÙ† Ø§Ù„ØªØ§Ø¡ Ø§Ù„Ù…ÙØªÙˆØ­Ø© ÙˆØ§Ù„Ù…Ø±Ø¨ÙˆØ·Ø©</td><td>2023-10-01</td><td>2023-10-20</td><td>ğŸ”„ Ù‚ÙŠØ¯ Ø§Ù„ØªØ¯Ø±ÙŠØ¨</td></tr>
                        </tbody>
                    </table>
                </div>`;
            });
            return html;
        }

        function generateDiagnosticReport(ids) {
            let html = `<table class="report-table"><thead><tr><th>Ø§Ù„Ø·Ø§Ù„Ø¨</th><th>Ù†ÙˆØ¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</th><th>Ø§Ù„Ø¯Ø±Ø¬Ø©</th><th>Ø§Ù„Ù†ØªÙŠØ¬Ø©</th><th>Ø§Ù„ØªÙˆØµÙŠØ©</th></tr></thead><tbody>`;
            ids.forEach(id => {
                const st = getStudentById(id);
                html += `<tr>
                    <td>${st.name}</td>
                    <td>Ø§Ø®ØªØ¨Ø§Ø± Ù†Ù…Ø§Ø¦ÙŠ (Ø§Ù†ØªØ¨Ø§Ù‡)</td>
                    <td>6/10</td>
                    <td>Ù…ØªÙˆØ³Ø·</td>
                    <td>ÙŠØ­ØªØ§Ø¬ ØªØ¯Ø±ÙŠØ¨Ø§Øª ØªØ±ÙƒÙŠØ² Ø¨ØµØ±ÙŠ</td>
                </tr>`;
            });
            return html + `</tbody></table>`;
        }

        function generateScheduleReport() {
            return `
            <table class="report-table">
                <thead><tr><th>Ø§Ù„Ø­ØµØ© / Ø§Ù„ÙŠÙˆÙ…</th><th>Ø§Ù„Ø£Ø­Ø¯</th><th>Ø§Ù„Ø§Ø«Ù†ÙŠÙ†</th><th>Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡</th><th>Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡</th><th>Ø§Ù„Ø®Ù…ÙŠØ³</th></tr></thead>
                <tbody>
                    <tr><td><strong>Ø§Ù„Ø£ÙˆÙ„Ù‰</strong></td><td>Ù†Ø§ÙŠÙ Ù…Ø­Ù…Ø¯</td><td>-</td><td>Ø³Ø¹ÙˆØ¯ ÙÙŠØµÙ„</td><td>-</td><td>Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø£Ø­Ù…Ø¯</td></tr>
                    <tr><td><strong>Ø§Ù„Ø«Ø§Ù†ÙŠØ©</strong></td><td>-</td><td>Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø£Ø­Ù…Ø¯</td><td>-</td><td>Ù†Ø§ÙŠÙ Ù…Ø­Ù…Ø¯</td><td>-</td></tr>
                    <tr><td><strong>Ø§Ù„Ø«Ø§Ù„Ø«Ø©</strong></td><td>Ø³Ø¹ÙˆØ¯ ÙÙŠØµÙ„</td><td>-</td><td>Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø£Ø­Ù…Ø¯</td><td>-</td><td>Ø³Ø¹ÙˆØ¯ ÙÙŠØµÙ„</td></tr>
                </tbody>
            </table>`;
        }

        function generateSessionBalanceReport(ids) {
            if (getCurrentUser().role !== 'teacher' && getCurrentUser().role !== 'admin') return '';
            let html = `<table class="report-table"><thead><tr><th>Ø§Ù„Ø·Ø§Ù„Ø¨</th><th>Ø§Ù„Ù…Ù‚Ø±Ø±</th><th>Ø§Ù„Ù…Ù†ÙØ°</th><th>Ø§Ù„Ø±ØµÙŠØ¯</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th></tr></thead><tbody>`;
            ids.forEach(id => {
                const st = getStudentById(id);
                const req = 15;
                const done = Math.floor(Math.random() * 20);
                const balance = done - req;
                let status = balance < 0 ? `<span class="status-bad">Ù†Ù‚Øµ (${balance})</span>` : `<span class="status-good">Ø²ÙŠØ§Ø¯Ø© (+${balance})</span>`;
                if(balance === 0) status = 'Ù…Ù†ØªØ¸Ù…';
                html += `<tr><td>${st.name}</td><td>${req}</td><td>${done}</td><td style="direction:ltr">${balance}</td><td>${status}</td></tr>`;
            });
            return html + `</tbody></table>`;
        }

        function generateCommitteeReport(ids) {
            let html = `<table class="report-table"><thead><tr><th>Ø§Ù„Ø·Ø§Ù„Ø¨</th><th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹</th><th>Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡</th><th>Ø§Ù„ØªÙˆØµÙŠØ§Øª</th><th>Ø§Ù„ØªÙˆÙ‚ÙŠØ¹</th></tr></thead><tbody>`;
            ids.forEach(id => {
                const st = getStudentById(id);
                html += `<tr>
                    <td>${st.name}</td>
                    <td>2023-12-01</td>
                    <td>Ø§Ù„Ù…Ø¯ÙŠØ±ØŒ Ø§Ù„Ù…Ø±Ø´Ø¯ØŒ Ø§Ù„Ù…Ø¹Ù„Ù…</td>
                    <td>Ø§Ø³ØªÙ…Ø±Ø§Ø± Ø§Ù„Ø·Ø§Ù„Ø¨ ÙÙŠ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ Ù…Ø¹ ØªÙƒØ«ÙŠÙ Ø§Ù„Ø®Ø·Ø· Ø§Ù„Ø³Ù„ÙˆÙƒÙŠØ©</td>
                    <td style="font-family:'Reem Kufi', cursive; color:#007bff;">(ØªÙ… Ø§Ù„ØªÙˆÙ‚ÙŠØ¹ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Ù‹)</td>
                </tr>`;
            });
            return html + `</tbody></table>`;
        }

        function generateCertificates(ids) {
            let html = '';
            ids.forEach(id => {
                const st = getStudentById(id);
                html += `
                <div style="border: 10px double #1565c0; padding: 40px; margin-bottom: 30px; text-align: center; height: 200mm; position: relative;">
                    <div style="position: absolute; top:0; left:0; width:100%; height:100%; opacity:0.05; background:url('assets/images/logo.png') no-repeat center center; background-size:contain;"></div>
                    <h1 style="color:#d4af37; font-size:40px; margin-bottom:10px;">Ø´Ù‡Ø§Ø¯Ø© Ø´ÙƒØ± ÙˆØªÙ‚Ø¯ÙŠØ±</h1>
                    <p style="font-size:18px;">ÙŠØ³Ø± Ø¥Ø¯Ø§Ø±Ø© Ø¨Ø±Ù†Ø§Ù…Ø¬ ØµØ¹ÙˆØ¨Ø§Øª Ø§Ù„ØªØ¹Ù„Ù… Ø£Ù† ØªØªÙ‚Ø¯Ù… Ø¨Ø£Ø¬Ù…Ù„ Ø¹Ø¨Ø§Ø±Ø§Øª Ø§Ù„Ø´ÙƒØ± Ù„Ù„Ø¨Ø·Ù„:</p>
                    <h2 style="color:#1565c0; font-size:35px; margin: 30px 0; border-bottom:2px solid #eee; display:inline-block; padding-bottom:10px;">${st.name}</h2>
                    <p style="font-size:20px;">ÙˆØ°Ù„Ùƒ Ù„ØªÙ…ÙŠØ²Ù‡ ÙˆØ¥ØªÙ‚Ø§Ù†Ù‡ Ù„Ù…Ù‡Ø§Ø±Ø©:</p>
                    <h3 style="background:#f9f9f9; padding:10px; display:inline-block;">( Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø¨ØµØ±ÙŠØ© )</h3>
                    <div style="margin-top: 80px; display:flex; justify-content:space-between; padding:0 50px;">
                        <div style="text-align:center;"><p><strong>Ù…Ø¹Ù„Ù… Ø§Ù„ØµØ¹ÙˆØ¨Ø§Øª</strong></p><p style="color:#777;">Ø£. Ù…Ø­Ù…Ø¯ Ø§Ù„Ø¹ØªÙŠØ¨ÙŠ</p></div>
                        <div style="text-align:center;"><p><strong>Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø¯Ø±Ø³Ø©</strong></p><p style="color:#777;">....................</p></div>
                    </div>
                </div>
                <div style="page-break-after: always;"></div>
                `;
            });
            return html;
        }

        function downloadPDF() {
            const element = document.getElementById('reportPaper');
            const opt = { margin: 0, filename: 'ØªÙ‚Ø±ÙŠØ±_Ù…ÙŠØ³Ø±_Ø§Ù„ØªØ¹Ù„Ù….pdf', image: { type: 'jpeg', quality: 0.98 }, html2canvas: { scale: 2 }, jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' } };
            html2pdf().set(opt).from(element).save();
        }
    </script>
</body>
</html>
