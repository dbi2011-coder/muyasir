<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø­Ø±Ø± Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± - Ù…ÙŠØ³Ø± Ø§Ù„ØªØ¹Ù„Ù…</title>
    <style>
        /* Ù†ÙØ³ Ø§Ù„Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© Ù…Ø¹ Ø¥Ø¶Ø§ÙØ§Øª */
        :root {
            --primary-color: #3498db;
            --secondary-color: #2c3e50;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
            --light-color: #ecf0f1;
            --border-color: #bdc3c7;
        }
        
        body {
            font-family: 'Tajawal', sans-serif;
            margin: 0;
            padding: 0;
            background: #f8f9fa;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .test-info h1 {
            margin: 0;
            color: var(--secondary-color);
        }
        
        .test-meta {
            display: flex;
            gap: 15px;
            margin-top: 10px;
        }
        
        .badge {
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .badge-primary {
            background: var(--primary-color);
            color: white;
        }
        
        .badge-success {
            background: var(--success-color);
            color: white;
        }
        
        .actions {
            display: flex;
            gap: 10px;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .btn-primary {
            background: var(--primary-color);
            color: white;
        }
        
        .btn-success {
            background: var(--success-color);
            color: white;
        }
        
        .btn-secondary {
            background: var(--secondary-color);
            color: white;
        }
        
        .btn-danger {
            background: var(--danger-color);
            color: white;
        }
        
        .questions-section {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .question-types {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .question-type {
            background: var(--light-color);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .question-type:hover {
            background: var(--primary-color);
            color: white;
            transform: translateY(-3px);
        }
        
        .question-icon {
            font-size: 2rem;
            margin-bottom: 10px;
        }
        
        .questions-list {
            margin-top: 30px;
        }
        
        .question-card {
            background: var(--light-color);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid var(--primary-color);
        }
        
        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .question-actions {
            display: flex;
            gap: 5px;
        }
        
        .btn-sm {
            padding: 5px 10px;
            font-size: 0.8rem;
        }
        
        /* Ù†Ø§ÙØ°Ø© Ù…Ù†Ø¨Ø«Ù‚Ø© */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal.show {
            display: flex;
        }
        
        .modal-content {
            background: white;
            border-radius: 10px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        .modal-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-body {
            padding: 20px;
        }
        
        .modal-footer {
            padding: 20px;
            border-top: 1px solid var(--border-color);
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        .form-control {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            font-family: 'Tajawal', sans-serif;
        }
        
        .choices-container {
            margin: 10px 0;
        }
        
        .choice-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 5px 0;
            padding: 8px;
            background: white;
            border-radius: 4px;
            border: 1px solid var(--border-color);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="test-info">
                <h1 id="testTitle">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</h1>
                <div class="test-meta">
                    <span class="badge badge-primary" id="testSubject">Ø§Ù„Ù…Ø§Ø¯Ø©</span>
                    <span id="questionCount">0 Ø£Ø³Ø¦Ù„Ø©</span>
                </div>
            </div>
            <div class="actions">
                <button class="btn btn-secondary" onclick="goBack()">â† Ø§Ù„Ø¹ÙˆØ¯Ø©</button>
                <button class="btn btn-success" onclick="saveTest()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</button>
            </div>
        </div>
        
        <div class="questions-section">
            <div class="section-header">
                <h2>Ø¥Ø¶Ø§ÙØ© Ø£Ø³Ø¦Ù„Ø©</h2>
                <button class="btn btn-primary" onclick="showQuestionTypes()">+ Ø¥Ø¶Ø§ÙØ© Ø³Ø¤Ø§Ù„</button>
            </div>
            
            <div class="question-types" id="questionTypes" style="display: none;">
                <div class="question-type" onclick="addQuestion('multiple-choice')">
                    <div class="question-icon">ğŸ”˜</div>
                    <div>Ø§Ø®ØªÙŠØ§Ø± Ù…Ù† Ù…ØªØ¹Ø¯Ø¯</div>
                </div>
                <div class="question-type" onclick="addQuestion('open-ended')">
                    <div class="question-icon">ğŸ“</div>
                    <div>Ø³Ø¤Ø§Ù„ Ù…ÙØªÙˆØ­</div>
                </div>
                <!-- ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø²ÙŠØ¯ Ù„Ø§Ø­Ù‚Ù‹Ø§ -->
            </div>
            
            <div class="questions-list" id="questionsList">
                <!-- Ø³ÙŠØªÙ… ØªØ¹Ø¨Ø¦ØªÙ‡ Ø¨Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±ÙŠØ¨Øª -->
            </div>
        </div>
    </div>
    
    <!-- Ù†Ø§ÙØ°Ø© Ø¥Ø¶Ø§ÙØ©/ØªØ¹Ø¯ÙŠÙ„ Ø³Ø¤Ø§Ù„ -->
    <div id="questionModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Ø¥Ø¶Ø§ÙØ© Ø³Ø¤Ø§Ù„ Ø¬Ø¯ÙŠØ¯</h3>
                <button class="modal-close" onclick="closeQuestionModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="questionForm">
                    <div class="form-group">
                        <label for="questionText">Ù†Øµ Ø§Ù„Ø³Ø¤Ø§Ù„:</label>
                        <textarea id="questionText" class="form-control" rows="3" required></textarea>
                    </div>
                    
                    <div id="questionExtraFields"></div>
                    
                    <div class="form-group">
                        <label for="passCriteria">Ù…Ø­Ùƒ Ø§Ù„Ø§Ø¬ØªÙŠØ§Ø² (%):</label>
                        <input type="number" id="passCriteria" class="form-control" min="0" max="100" value="70" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeQuestionModal()">Ø¥Ù„ØºØ§Ø¡</button>
                <button type="button" class="btn btn-success" onclick="saveQuestionToTest()">Ø­ÙØ¸ Ø§Ù„Ø³Ø¤Ø§Ù„</button>
            </div>
        </div>
    </div>

    <script>
        let currentTest = null;
        let questions = [];
        let currentQuestionIndex = -1;
        let currentQuestionType = '';
        let isEditing = false;
        
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù†Ø¯ Ø¨Ø¯Ø¡ Ø§Ù„ØµÙØ­Ø©
        document.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const testId = urlParams.get('id');
            
            if (!testId) {
                alert('Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ø®ØªØ¨Ø§Ø±');
                window.location.href = 'diagnostic-tests.html';
                return;
            }
            
            loadTest(testId);
        });
        
        function loadTest(testId) {
            const tests = JSON.parse(localStorage.getItem('diagnosticTests') || '[]');
            currentTest = tests.find(t => t.id == testId);
            
            if (!currentTest) {
                alert('Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
                window.location.href = 'diagnostic-tests.html';
                return;
            }
            
            // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            document.getElementById('testTitle').textContent = currentTest.title;
            document.getElementById('testSubject').textContent = currentTest.subject;
            
            questions = currentTest.questions || [];
            updateQuestionCount();
            displayQuestions();
        }
        
        function showQuestionTypes() {
            const typesDiv = document.getElementById('questionTypes');
            typesDiv.style.display = typesDiv.style.display === 'none' ? 'grid' : 'none';
        }
        
        function addQuestion(type) {
            currentQuestionType = type;
            isEditing = false;
            currentQuestionIndex = -1;
            
            document.getElementById('modalTitle').textContent = 'Ø¥Ø¶Ø§ÙØ© Ø³Ø¤Ø§Ù„ Ø¬Ø¯ÙŠØ¯';
            document.getElementById('questionText').value = '';
            document.getElementById('passCriteria').value = '70';
            
            // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ© Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ø³Ø¤Ø§Ù„
            const extraFields = document.getElementById('questionExtraFields');
            extraFields.innerHTML = '';
            
            if (type === 'multiple-choice') {
                extraFields.innerHTML = `
                    <div class="form-group">
                        <label>Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª:</label>
                        <div id="choicesContainer">
                            <div class="choice-item">
                                <input type="radio" name="correctChoice" value="0" required>
                                <input type="text" class="form-control choice-input" placeholder="Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ø£ÙˆÙ„" required>
                                <button type="button" class="btn btn-sm btn-danger" onclick="removeChoice(this)">Ø­Ø°Ù</button>
                            </div>
                            <div class="choice-item">
                                <input type="radio" name="correctChoice" value="1" required>
                                <input type="text" class="form-control choice-input" placeholder="Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ø«Ø§Ù†ÙŠ" required>
                                <button type="button" class="btn btn-sm btn-danger" onclick="removeChoice(this)">Ø­Ø°Ù</button>
                            </div>
                        </div>
                        <button type="button" class="btn btn-sm btn-success" onclick="addChoice()">+ Ø¥Ø¶Ø§ÙØ© Ø®ÙŠØ§Ø±</button>
                    </div>
                `;
            }
            
            document.getElementById('questionModal').classList.add('show');
        }
        
        function addChoice() {
            const container = document.getElementById('choicesContainer');
            const choiceCount = container.children.length;
            
            const choiceElement = document.createElement('div');
            choiceElement.className = 'choice-item';
            choiceElement.innerHTML = `
                <input type="radio" name="correctChoice" value="${choiceCount}">
                <input type="text" class="form-control choice-input" placeholder="Ø§Ù„Ø®ÙŠØ§Ø± ${choiceCount + 1}" required>
                <button type="button" class="btn btn-sm btn-danger" onclick="removeChoice(this)">Ø­Ø°Ù</button>
            `;
            
            container.appendChild(choiceElement);
        }
        
        function removeChoice(button) {
            const container = document.getElementById('choicesContainer');
            if (container.children.length > 2) {
                button.closest('.choice-item').remove();
                updateChoiceIndices();
            }
        }
        
        function updateChoiceIndices() {
            const choices = document.querySelectorAll('#choicesContainer .choice-item');
            choices.forEach((choice, index) => {
                choice.querySelector('input[type="radio"]').value = index;
            });
        }
        
        function saveQuestionToTest() {
            const text = document.getElementById('questionText').value.trim();
            const passCriteria = parseInt(document.getElementById('passCriteria').value);
            
            if (!text) {
                alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù†Øµ Ø§Ù„Ø³Ø¤Ø§Ù„');
                return;
            }
            
            const question = {
                id: generateId(),
                type: currentQuestionType,
                text: text,
                passCriteria: passCriteria,
                createdAt: new Date().toISOString()
            };
            
            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ© Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ø³Ø¤Ø§Ù„
            if (currentQuestionType === 'multiple-choice') {
                const choices = [];
                const choiceInputs = document.querySelectorAll('.choice-input');
                choiceInputs.forEach(input => choices.push(input.value.trim()));
                
                const correctChoice = document.querySelector('input[name="correctChoice"]:checked');
                
                question.choices = choices;
                question.correctChoice = correctChoice ? parseInt(correctChoice.value) : 0;
            }
            
            if (isEditing && currentQuestionIndex >= 0) {
                questions[currentQuestionIndex] = question;
            } else {
                questions.push(question);
            }
            
            saveQuestions();
            displayQuestions();
            closeQuestionModal();
            
            alert(isEditing ? 'ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø¤Ø§Ù„' : 'ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø³Ø¤Ø§Ù„');
        }
        
        function displayQuestions() {
            const container = document.getElementById('questionsList');
            
            if (questions.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø³Ø¦Ù„Ø© Ø¨Ø¹Ø¯</p>';
                return;
            }
            
            container.innerHTML = questions.map((question, index) => `
                <div class="question-card">
                    <div class="question-header">
                        <div>
                            <strong>Ø§Ù„Ø³Ø¤Ø§Ù„ ${index + 1}:</strong> ${question.text.substring(0, 50)}...
                            <br><small>Ù†ÙˆØ¹: ${getQuestionTypeText(question.type)} | Ø§Ø¬ØªÙŠØ§Ø²: ${question.passCriteria}%</small>
                        </div>
                        <div class="question-actions">
                            <button class="btn btn-sm btn-primary" onclick="editQuestion(${index})">ØªØ¹Ø¯ÙŠÙ„</button>
                            <button class="btn btn-sm btn-danger" onclick="deleteQuestion(${index})">Ø­Ø°Ù</button>
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        function editQuestion(index) {
            const question = questions[index];
            if (!question) return;
            
            currentQuestionIndex = index;
            currentQuestionType = question.type;
            isEditing = true;
            
            document.getElementById('modalTitle').textContent = 'ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø³Ø¤Ø§Ù„';
            document.getElementById('questionText').value = question.text;
            document.getElementById('passCriteria').value = question.passCriteria;
            
            const extraFields = document.getElementById('questionExtraFields');
            extraFields.innerHTML = '';
            
            if (question.type === 'multiple-choice') {
                let choicesHtml = `
                    <div class="form-group">
                        <label>Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª:</label>
                        <div id="choicesContainer">
                `;
                
                question.choices.forEach((choice, i) => {
                    choicesHtml += `
                        <div class="choice-item">
                            <input type="radio" name="correctChoice" value="${i}" ${i === question.correctChoice ? 'checked' : ''}>
                            <input type="text" class="form-control choice-input" value="${choice}" required>
                            <button type="button" class="btn btn-sm btn-danger" onclick="removeChoice(this)">Ø­Ø°Ù</button>
                        </div>
                    `;
                });
                
                choicesHtml += `
                        </div>
                        <button type="button" class="btn btn-sm btn-success" onclick="addChoice()">+ Ø¥Ø¶Ø§ÙØ© Ø®ÙŠØ§Ø±</button>
                    </div>
                `;
                
                extraFields.innerHTML = choicesHtml;
            }
            
            document.getElementById('questionModal').classList.add('show');
        }
        
        function deleteQuestion(index) {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø³Ø¤Ø§Ù„ØŸ')) {
                questions.splice(index, 1);
                saveQuestions();
                displayQuestions();
                updateQuestionCount();
                alert('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø³Ø¤Ø§Ù„');
            }
        }
        
        function saveQuestions() {
            if (!currentTest) return;
            
            currentTest.questions = questions;
            
            const tests = JSON.parse(localStorage.getItem('diagnosticTests') || '[]');
            const index = tests.findIndex(t => t.id == currentTest.id);
            
            if (index >= 0) {
                tests[index] = currentTest;
            }
            
            localStorage.setItem('diagnosticTests', JSON.stringify(tests));
            updateQuestionCount();
        }
        
        function updateQuestionCount() {
            document.getElementById('questionCount').textContent = `${questions.length} Ø£Ø³Ø¦Ù„Ø©`;
        }
        
        function closeQuestionModal() {
            document.getElementById('questionModal').classList.remove('show');
            document.getElementById('questionTypes').style.display = 'none';
        }
        
        function saveTest() {
            saveQuestions();
            alert('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø¨Ù†Ø¬Ø§Ø­');
            
            setTimeout(() => {
                window.location.href = 'diagnostic-tests.html';
            }, 1000);
        }
        
        function goBack() {
            window.location.href = 'diagnostic-tests.html';
        }
        
        function getQuestionTypeText(type) {
            const types = {
                'multiple-choice': 'Ø§Ø®ØªÙŠØ§Ø± Ù…Ù† Ù…ØªØ¹Ø¯Ø¯',
                'open-ended': 'Ø³Ø¤Ø§Ù„ Ù…ÙØªÙˆØ­'
            };
            return types[type] || type;
        }
        
        function generateId() {
            return Math.floor(Math.random() * 1000000) + 1;
        }
    </script>
</body>
</html>
